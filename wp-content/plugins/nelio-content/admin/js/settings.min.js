!function(a){"use strict";var e=window.location.href,t="social-profiles",i=!1;if(/\btab=[^&]+\b/.test(e)?t=e.match(/\btab=([^&]+)\b/)[1]:e+="&tab=social-profiles",!NelioContentSettings.isYoastSEOAvailable){var n=a("#qa-is-yoast-seo-integrated");n.prop("disabled",!0),n.closest("tr").find("th, td").addClass("nc-disabled-setting")}if(-1!==e.indexOf("automations-walkthrough")){i=!0,e=e.replace(/automations-walkthrough(=[^&]+)?.?/,"").replace(/\?$|&$/,""),window.history.replaceState({},"",e);var o=a(".nav-tab");_.each(o,function(e){var t=a(e),i=t.attr("href");i=i.replace(/automations-walkthrough(=[^&]+)?.?/,"").replace(/\?$|&$/,""),t.attr("href",i)})}function s(){var e=a("#google-analytics-view-container");l.is(":checked")?(e.find("*").prop("disabled",!1),e.closest("tr").find("th, td").removeClass("nc-disabled-setting"),a(".nc-ga-setting-change-profile .nc-change").css("cursor","pointer"),a(".nc-ga-setting-change-profile .nc-change-wrapper").css("color","#666")):(e.find("*").prop("disabled",!0),e.closest("tr").find("th, td").addClass("nc-disabled-setting"),a(".nc-ga-setting-change-profile .nc-change").css("cursor","auto"),a(".nc-ga-setting-change-profile .nc-change-wrapper").css("color","inherit"))}var l=a("#use-analytics");l.on("change",s),l.on("keyup",s),l.on("click",s),s(),NelioContent.views.GoogleAnalyticsSettingView=Backbone.View.extend({_mode:void 0,_$input:void 0,_$select:void 0,_changeProfileTemplate:NelioContent.helpers.getTemplate("_ga-setting-change-profile"),_retrieveGACodeTemplate:NelioContent.helpers.getTemplate("_ga-setting-retrieve-code"),events:{"click .nc-action.nc-dismiss-tokens-warning":"_dismissTokensWarning","change .nc-ga-selector":"_onGAViewChange","click .nc-action.nc-change":"_confirmAccountChange","click .nc-action.nc-do-change":"_doAccountChange","click .nc-action.nc-cancel-change":"_cancelAccountChange","click .nc-connect-ga":"_doConnection","change .nc-ga-code":"_onGACodeChange","keydown .nc-ga-code":"_onGACodeChange","paste .nc-ga-code":"_onGACodeChange","keyup .nc-ga-code":"_onGACodeChange","click .nc-ga-code-cancel":"_cancelCodeRetrieval","click .nc-ga-code-accept":"_processGACode","click .button.nc-refresh-analytics":"_refreshAnalytics"},initialize:function(e){this._$input=e.$input,this._$input.data("token-error")?this._mode="token-error":this._$input.val()?this._mode="view-selector":this._mode="connect-button",this.render=_.bind(this.render,this),this.listenTo(this,"nc:render",this.render),this._manageConfirmButton=_.debounce(this._manageConfirmButton,100)},render:function(){switch(this._mode){case"token-error":this._renderTokensExpirationWarning();break;case"view-selector":case"view-selector-awaiting-confirmation":case"view-selector-changing":this._renderViewSelector();break;case"connect-button":this._renderConnectButton();break;case"ga-retrieving-code":case"ga-code-retrieval":this._renderGACodeRetrieval()}return this.trigger("nc:change:analytics"),this},_renderTokensExpirationWarning:function(){this.$el.html("<p>"+NelioContent.i18n.feedback.gaTokensExpired+'</p><a class="button nc-action nc-dismiss-tokens-warning">'+NelioContent.i18n.actions.ok+"</a>")},_renderViewSelector:function(){if(void 0===this._$select)return this.$el.html('<span class="spinner is-active nc-ga-loading"></span>'),void this._loadViewsFromGoogleAnalytics();this.$(".nc-ga-setting-change-profile").html(this._changeProfileTemplate({mode:this._mode}))},_loadViewsFromGoogleAnalytics:function(){var i=this;a.ajax({url:ajaxurl,data:{action:"nelio_content_get_ga_views"},success:function(e){var t=i._prepareViewSelectorData(e);i._makeViewSelector(t)},error:function(e){NelioContent.helpers.openErrorDialog(e.responseJSON),i._makeViewSelector([])}})},_renderConnectButton:function(){var e="<div>";e+='<button class="button nc-connect-ga">'+NelioContent.i18n.actions.connectGoogleAnalytics+"</button> ",e+='<button class="button nc-refresh-analytics">'+NelioContent.i18n.actions.refreshAnalytics+"</button>";var t=a(e+="</div>");this.$el.html(t)},_dismissTokensWarning:function(e){e.preventDefault(),this._mode="connect-button",this.trigger("nc:render")},_doConnection:function(e){e.preventDefault(),this._mode="ga-code-retrieval",this.trigger("nc:render")},_renderGACodeRetrieval:function(){this.$el.html(a('<div class="ga-setting-retrieve-code"></div>')),this.$(".ga-setting-retrieve-code").html(this._retrieveGACodeTemplate({})),e="https://accounts.google.com/o/oauth2/v2/auth?client_id=1085875842646-v5k3smokc0j3hnjev0q2bq7r3kbgqlmm.apps.googleusercontent.com&response_type=code&redirect_uri=urn:ietf:wg:oauth:2.0:oob&scope=https://www.googleapis.com/auth/analytics.readonly";NelioContent.helpers.openPopup(e,640,480)},_onGACodeChange:function(e){13===e.keyCode&&e.preventDefault(),this._manageConfirmButton(e)},_manageConfirmButton:function(e){if("ga-code-retrieval"===this._mode){var t=a(".nc-ga-code"),i=a(".nc-ga-code-accept");t.val()?(i.prop("disabled",!1),"keyup"===e.type&&13===e.keyCode&&this._processGACode(e)):i.prop("disabled",!0)}},_cancelCodeRetrieval:function(e){e.preventDefault(),this._mode="connect-button",this.trigger("nc:render")},_processGACode:function(e){if(e.preventDefault(),"ga-retrieving-code"!==this._mode){this._mode="ga-retrieving-code";var t=a(".nc-ga-code"),i=a(".nc-ga-code-accept"),n=a(".nc-ga-code-cancel");t.prop("disabled",!0),i.prop("disabled",!0),n.prop("disabled",!0),i.html(NelioContent.i18n.feedback.loading);var o=a(".nc-ga-code").val(),s=this;a.ajax({url:ajaxurl,data:{action:"nelio_content_get_ga_token",code:o},success:function(e){s._mode="view-selector",s._loadViewsFromGoogleAnalytics()},error:function(e){NelioContent.helpers.openErrorDialog(e.responseJSON),i.html(NelioContent.i18n.actions.load),t.prop("disabled",!1),i.prop("disabled",!1),n.prop("disabled",!1),s._mode="ga-code-retrieval"}})}},_prepareViewSelectorData:function(e){var t=this._$input.val(),i=[];return e.items.forEach(function(e){e.webProperties&&e.webProperties.forEach(function(e){var t=_.map(e.profiles,function(e){return{id:e.id,text:e.name}});i.push({id:e.id,text:e.name,children:t})})}),_.contains(_.pluck(_.flatten(_.pluck(i,"children")),"id"),t)||this._updateHiddenInput(""),i},_makeViewSelector:function(e){this._$select=a('<select class="nc-ga-selector"></select>'),this.$el.html(this._$select),this.$el.append(a('<div class="nc-ga-setting-change-profile"></div>')),this._$select.ncselect2({data:e,templateResult:this._templateGAViewResult,width:"400px",dropdownCssClass:"nc-ga-selector-dropdown",placeholder:NelioContent.i18n.settings.gaSelectorPlaceholder}),this._$select.val(this._$input.val()),this._$select.trigger("change"),this.trigger("nc:render")},_onGAViewChange:function(){this._updateHiddenInput(this._$select.val())},_confirmAccountChange:function(){this._mode="view-selector-awaiting-confirmation",this.trigger("nc:render")},_cancelAccountChange:function(){this._mode="view-selector",this.trigger("nc:render")},_doAccountChange:function(){this._mode="connect-button",this._$select.ncselect2("destroy"),this._$select=void 0,this._updateHiddenInput(""),this.trigger("nc:render")},_templateGAViewResult:function(e){return void 0!==e.children?a('<span class="nc-ga-view-text">'+e.text+'</span><span class="nc-ga-view-id">('+e.id+")</span>"):a('<span class="nc-ga-view-text">'+e.text+"</span>")},_refreshAnalytics:function(e){e.preventDefault(),(new NelioContent.views.AnalyticsRefresherSettingView).render().open()},_updateHiddenInput:function(e){this._$input.val(e).trigger("change"),this.$(".nc-refresh-analytics").prop("disabled",e!==NelioContent.analytics.gaViewId)},close:function(){this.stopListening(),this.unbind(),void 0!==this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}}),NelioContent.views.AnalyticsRefresherSettingView=Backbone.View.extend({_buttons:void 0,_closed:!1,_data:void 0,className:"nc-analytics-refresher-dialog",template:NelioContent.helpers.getTemplate("_analytics-refresher-dialog"),events:{"change .nc-period":"_changePeriod"},initialize:function(e){this.render=_.bind(this.render,this),this._requestNextBatch=_.bind(this._requestNextBatch,this),this._processBatch=_.bind(this._processBatch,this),this.listenTo(this,"nc:render",this.render),this.listenTo(this,"nc:click:dialog:cancel",this.close),this.listenTo(this,"nc:click:dialog:refresh-analytics",this._refreshAnalytics);var t=this;this.$el.dialog({title:NelioContent.i18n.titles.refreshAnalytics,modal:!0,autoOpen:!1,closeOnEscape:!1,width:Math.min(500,a(window).width()-20),dialogClass:"nc-dialog",buttons:[NelioContent.helpers.makeDialogButton(this,"cancel",NelioContent.i18n.actions.cancel,!1),NelioContent.helpers.makeDialogButton(this,"refresh-analytics",NelioContent.i18n.actions.refreshAnalytics,!0)],close:function(){t.close()}}),this._data={batch:0,period:"month",processedItems:0,totalItems:0}},render:function(){return this.$el.html(this.template()),this},open:function(){this.$el.dialog("open");var e=this.$el.closest(".ui-dialog");return this._buttons={$refresh:e.find(".nc-refresh-analytics-button"),$cancel:e.find(".nc-cancel-button")},this},_lock:function(){this._buttons.$refresh.prop("disabled",!0),this.$("select").prop("disabled",!0),this.$("input").prop("disabled",!0)},_unlock:function(){this.$("input").prop("disabled",!1),this.$("select").prop("disabled",!1),this._buttons.$refresh.prop("disabled",!1),this._buttons.$refresh.html(NelioContent.i18n.actions.refreshAnalytics)},_changePeriod:function(e){e.preventDefault(),this._data.period=this.$(".nc-period").val()},_refreshAnalytics:function(){this._lock(),this._buttons.$refresh.html(NelioContent.i18n.feedback.refreshingAnalytics),this._data.batch=0,this._data.processedItems=0,this.$(".nc-count .nc-total").html(NelioContent.i18n.feedback.retrievingPosts),this._requestNextBatch()},_requestNextBatch:function(){if(!this._closed){++this._data.batch;var t=this;a.ajax({url:ajaxurl,data:{action:"nelio_content_get_post_ids",page:this._data.batch,period:this._data.period},success:function(e){if(1===t._data.batch&&0===parseInt(e.found))return t.close(),void NelioContent.helpers.openWarningDialog(NelioContent.i18n.titles.refreshAnalytics,NelioContent.i18n.dialogs.analyticsNoPostsFound);"object"==typeof e.items&&0!==e.items.length?(1===t._data.batch&&(t._data.totalItems=parseInt(e.found),t._updateProgressBar()),t._processBatch(e.items)):t._updateLastGlobalUpdate()},error:function(){t._unlock()}})}},_processBatch:function(e){for(var t=this,i=[],n=0;n<e.length;++n)i.push(a.ajax({url:ajaxurl,data:{action:"nelio_content_update_analytics",post:e[n]},complete:function(){t._closed||(++t._data.processedItems,t._updateProgressBar())}}));a.when.apply(this,i).always(this._requestNextBatch)},_updateLastGlobalUpdate:function(){this._buttons.$cancel.prop("disabled",!0),this.$(".nc-count .nc-current").empty(),this.$(".nc-count .nc-total").html(NelioContent.i18n.feedback.waitAMoment);var e=this;a.ajax({url:ajaxurl,data:{action:"nelio_content_update_analytics_last_global_update"},complete:function(){e.close(),NelioContent.helpers.openDialog(NelioContent.i18n.titles.refreshAnalytics,"<p>"+NelioContent.i18n.dialogs.analyticsProcessed.replace(/{posts}/,e._data.totalItems)+"</p>")}})},_updateProgressBar:function(){if(!this._closed){var e=Math.round(100*this._data.processedItems/this._data.totalItems);this.$(".nc-progress-bar").css("width",Math.min(100,e)+"%"),this.$(".nc-count .nc-current").html(this._data.processedItems),this.$(".nc-count .nc-total").html("/"+this._data.totalItems)}},close:function(){this.$el.dialog("destroy"),this._closed=!0,this.stopListening(),this.unbind(),void 0!==this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}});var r=new NelioContent.views.GoogleAnalyticsSettingView({el:a("#google-analytics-view-container"),$input:a("#google-analytics-view-input")});Backbone.listenTo(r,"nc:change:analytics",s),r.render();var c,d=a("#use-external-featured-image");function h(){var e=!d.is(":checked");a("#efi-mode, #auto-feat-image").prop("disabled",e)}function p(){ncstore.remove("nc-social-profiles["+NelioContent.wpBlogId+"]"),ncstore.remove("nc-social-templates["+NelioContent.wpBlogId+"]")}d.on("change",h),d.on("keyup",h),d.on("click",h),h(),"social-profiles"===t&&(NelioContent.views.ConnectedSocialProfile=Backbone.View.extend({_deletionStatus:"none",className:"nc-connected-profile",template:NelioContent.helpers.getTemplate("_nc-connected-social-profile"),events:{mouseleave:"_cancelProfileDeletion","click span.nc-auto-publication":"_toggleAutoPublication","click span.nc-auto-reshare":"_toggleAutoReshare","change input.nc-auto-publication":"_changeAutoFrequency","change input.nc-auto-reshare":"_changeAutoFrequency","keyup input.nc-auto-publication":"_changeAutoFrequency","keyup input.nc-auto-reshare":"_changeAutoFrequency","click .nc-delete":"_askForProfileDeletionConfirmation","click .nc-cancel-deletion":"_cancelProfileDeletion","click .nc-do-delete":"_deleteProfile","click .nc-reauthenticate":"_reauthenticateProfile","click .nc-refresh":"_reauthenticateProfile"},initialize:function(){this.render=_.bind(this.render,this),this.listenTo(this,"nc:render",this.render),this.listenTo(this.model,"change",this.render),this._doChangeAutoFrequencies=_.debounce(this._doChangeAutoFrequencies,1e3)},render:function(){var e=this.model.toJSON();return e.deletionStatus=this._deletionStatus,e.addedByCurrentUser=this.model.get("creatorId")===NelioContent.users.current().get("id"),this.el.innerHTML=this.template(e),this.el.className=this.className,"renew"===this.model.get("status")&&(this.el.className+=" nc-authentication-required"),"deleting"===this._deletionStatus&&(this.el.className+=" nc-deleting"),this},_toggleAutoPublication:function(e){e.preventDefault(),this.trigger("nc:toggle:publicationFrequency",this.model)},_toggleAutoReshare:function(e){e.preventDefault(),this.trigger("nc:toggle:reshareFrequency",this.model)},_changeAutoFrequency:function(e){e.preventDefault(),this._doChangeAutoFrequencies()},_doChangeAutoFrequencies:function(){var e=parseInt(this.$(".nc-auto-publication").val(),10)||0,t=parseInt(this.$(".nc-auto-reshare").val(),10)||0;e=Math.min(Math.max(e,0),20),t=Math.min(Math.max(t,0),20),this.model.setAutoFrequencies(e,t)},_askForProfileDeletionConfirmation:function(){return this._deletionStatus="awaiting-confirmation",this.trigger("nc:render"),!1},_cancelProfileDeletion:function(){return"awaiting-confirmation"===this._deletionStatus&&(this._deletionStatus="none",this.trigger("nc:render")),!1},_deleteProfile:function(){return this._deletionStatus="deleting",this.trigger("nc:render"),this.model.destroy(),!1},_reauthenticateProfile:function(e){var t=e.target||e.srcElement,i=a(t).data("href");return NelioContent.helpers.openPopup(i,640,480),!1},close:function(){this.stopListening(),this.unbind(),void 0!==this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}}),NelioContent.views.SocialProfileSettings=Backbone.View.extend({_profileViews:[],_wasAbleToAccessAws:!0,_isAutomationsWalkthroughActive:!1,template:NelioContent.helpers.getTemplate("_nc-social-profile-settings"),events:{"click .nc-network:not( .nc-disabled ) .nc-logo":"_addSocialProfile","click .nc-automations-walkthrough":"startAutomationsWalkthrough","click .nc-reset-social-messages":"_resetSocialMessages","change .nc-auto-sharer-frequency":"_updateProfileAutoPublicationFrequency"},initialize:function(){this.collection=NelioContent.profiles,this.render=_.bind(this.render,this),this.listenTo(this.collection,"nc:ready",this.render),this.listenTo(this.collection,"reset",this._resetSocialProfileViews),this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"add",this._addSocialProfileView),this.listenTo(this.collection,"add",this.render),this.listenTo(this.collection,"remove",this._removeProfileView),this.listenTo(this.collection,"remove",this.render);var e=this;this.listenTo(this.collection,"nc:error",function(){e._wasAbleToAccessAws=!1,e.render()}),this.collection.isReady()&&(this.collection.each(_.bind(this._addSocialProfileView,this)),this.collection.trigger("nc:ready"))},render:function(){if(!this._wasAbleToAccessAws)return this.el.innerHTML='<p><span class="nc-dashicons nc-dashicons-warning nc-colorize-error"></span> '+NelioContent.i18n.errors.api.emptyAjaxStatus+"</p>",this;var e={isTwitterEnabled:!0,isFacebookEnabled:!0,isGooglePlusEnabled:!0,isInstagramEnabled:!0,isLinkedInEnabled:!0,isPinterestEnabled:!0,isTumblrEnabled:!0,maxNumOfProfiles:0<NelioContent.misc.maxProfiles?NelioContent.misc.maxProfiles:NelioContent.networkMetas.length,isLoadingSocialProfiles:!NelioContent.profiles.isReady(),numOfConnectedProfiles:this.collection.length};if(0<NelioContent.misc.maxProfilesPerNetwork){var t=NelioContent.misc.maxProfilesPerNetwork;NelioContent.profiles.where({network:"twitter"}).length>=t&&(e.isTwitterEnabled=!1),NelioContent.profiles.where({network:"facebook"}).length>=t&&(e.isFacebookEnabled=!1),NelioContent.profiles.where({network:"googleplus"}).length>=t&&(e.isGooglePlusEnabled=!1),NelioContent.profiles.where({network:"instagram"}).length>=t&&(e.isInstagramEnabled=!1),NelioContent.profiles.where({network:"linkedin"}).length>=t&&(e.isLinkedInEnabled=!1),NelioContent.profiles.where({network:"pinterest"}).length>=t&&(e.isPinterestEnabled=!1),NelioContent.profiles.where({network:"tumblr"}).length>=t&&(e.isTumblrEnabled=!1)}if(0<NelioContent.misc.maxProfiles&&NelioContent.profiles.length>=NelioContent.misc.maxProfiles&&(e.isTwitterEnabled=!1,e.isFacebookEnabled=!1,e.isGooglePlusEnabled=!1,e.isInstagramEnabled=!1,e.isLinkedInEnabled=!1,e.isPinterestEnabled=!1,e.isTumblrEnabled=!1),this.el.innerHTML=this.template(e),!NelioContent.misc.usesCustomAutomationFrequencies){var i=this.collection.guessFrequency();this.$(".nc-auto-sharer-frequency").val(i)}this._updateMessageEstimate(),this._rendered=0!==this.collection.length;var n=this.$(".nc-connected-profiles");return n.children().detach(),_.each(this._profileViews,function(e){n.append(e.render().el)},this),this.trigger("nc:profiles:rendered"),this},startAutomationsWalkthrough:function(e){if(!this._isAutomationsWalkthroughActive){this._isAutomationsWalkthroughActive=!0,e&&e.preventDefault();var t={target:".nc-auto-publication:eq(0)",title:NelioContent.i18n.pointers.automations.publication,content:NelioContent.helpers.trim(document.getElementById("_nc-automations-publication-pointer").innerHTML),position:{edge:"right",align:"middle"}},i={target:".nc-auto-reshare:eq(0)",title:NelioContent.i18n.pointers.automations.reshare,content:NelioContent.helpers.trim(document.getElementById("_nc-automations-reshare-pointer").innerHTML),position:{edge:"right",align:"middle"}},n={target:".nc-auto-sharer-frequency:eq(0)",title:NelioContent.i18n.pointers.automations.frequency,content:NelioContent.helpers.trim(document.getElementById("_nc-automations-frequency-pointer").innerHTML),position:{edge:"right",align:"middle"}},o={target:".nc-message-estimate:eq(0)",title:NelioContent.i18n.pointers.automations.messageCounter,content:NelioContent.helpers.trim(document.getElementById("_nc-automations-counter-pointer").innerHTML),position:{edge:"bottom",align:"middle"}},s={target:"#social-templates",title:NelioContent.i18n.pointers.automations.templates,content:NelioContent.helpers.trim(document.getElementById("_nc-automations-template-pointer").innerHTML),position:{edge:"top",align:"left"}},l=this;NelioContent.helpers.startPointerTour([t,i,s,n,o],function(){l._isAutomationsWalkthroughActive=!1,a("html, body").animate({scrollTop:0},500)})}},_addSocialProfile:function(e){var t,i;e.preventDefault();var n=e.target||e.srcElement,o=a(n);switch(o.closest(".nc-network").data("network")){case"facebook-personal":t=NelioContent.helpers.getTemplate("_nc-connect-facebook-profile-dialog"),i=NelioContent.helpers.openDialog("Facebook","<div>"+t()+"</div>");break;case"linkedin-personal":t=NelioContent.helpers.getTemplate("_nc-connect-linkedin-profile-dialog"),i=NelioContent.helpers.openDialog("LinkedIn","<div>"+t()+"</div>");break;case"googleplus":t=NelioContent.helpers.getTemplate("_nc-connect-googleplus-profile-dialog"),i=NelioContent.helpers.openDialog("Google+","<div>"+t()+"</div>");break;default:var s=o.closest(".nc-network").data("href");NelioContent.helpers.openPopup(s,640,480)}i&&i.find(".nc-logo").on("click",function(){i.dialog("close");var e=a(this).data("href");NelioContent.helpers.openPopup(e,640,480)})},_toggleAutoPublication:function(e){e.toggleAutoPublication(this.$(".nc-auto-sharer-frequency").val()),this._updateMessageEstimate()},_toggleAutoReshare:function(e){e.toggleAutoReshare(this.$(".nc-auto-sharer-frequency").val()),this._updateMessageEstimate()},_resetSocialMessages:function(e){e.preventDefault(),a.ajax({url:ajaxurl,data:{action:"nelio_content_reset_auto_social_messages"},success:function(){NelioContent.helpers.openDialog(NelioContent.i18n.titles.resetSocialMessages,"<div>"+NelioContent.i18n.dialogs.resetSocialMessages+"</div>")}})},_updateProfileAutoPublicationFrequency:function(e){var t=e.target||e.srcElement,i=a(t),n=i.val();this.collection.each(function(e){e.setAutoPublicationFrequency(n)}),this.$(".nc-message-estimate").text(i.val()),this._updateMessageEstimate()},_updateMessageEstimate:function(){var e=this.collection.reduce(function(e,t){return e+t.get("publicationFrequency")},0);e=Math.min(e,30),e=Math.min(e,NelioContent.i18n.settings.publicationEstimateMessages.length);var t=this.collection.reduce(function(e,t){return e+t.get("reshareFrequency")},0);t=Math.min(t,30),t=Math.min(t,NelioContent.i18n.settings.reshareEstimateMessages.length);var i=NelioContent.i18n.settings.reshareEstimateMessages[t]+" ";i+=NelioContent.i18n.settings.publicationEstimateMessages[e],(i=NelioContent.helpers.trim(i)).length||(i=NelioContent.i18n.settings.emptyEstimateMessages),this.$(".nc-message-estimate").html(i),e+t?this.$(".nc-auto-sharer-frequency").prop("disabled",this.collection.where({synching:!0}).length):this.$(".nc-auto-sharer-frequency").prop("disabled",!0),e+t?this.$(".nc-reset-social-messages").show():this.$(".nc-reset-social-messages").hide()},_addSocialProfileView:function(e){var t=new NelioContent.views.ConnectedSocialProfile({model:e});this.listenTo(e,"change:synching",this._updateMessageEstimate),this.listenTo(t,"nc:toggle:publicationFrequency",this._toggleAutoPublication),this.listenTo(t,"nc:toggle:reshareFrequency",this._toggleAutoReshare),this._profileViews.push(t)},_removeProfileView:function(t){var e=_.filter(this._profileViews,function(e){return e.model===t},this);if(0<e.length){var i=e[0];this._profileViews=_.without(this._profileViews,i),this.stopListening(i),i.close()}this.stopListening(t)},_resetSocialProfileViews:function(){_.each(this._profileViews,function(e){e.close()},this),this._profileViews=[],this.collection.each(_.bind(this._addSocialProfileView,this)),this._profileViews.sort(function(e,t){var i=e.model.get("creationDate"),n=t.model.get("creationDate");return n.isBefore(i)?-1:n.isAfter(i)?1:0})},close:function(){_.each(this._profileViews,function(e){e.close()},this),this._profileViews=[],this.stopListening(),this.unbind(),void 0!==this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}}),c=new NelioContent.views.SocialProfileSettings,i&&Backbone.listenToOnce(c,"nc:profiles:rendered",_.debounce(c.startAutomationsWalkthrough,750)),a("#social-profile-settings-container").html(c.render().el)),"social-templates"===t&&(NelioContent.views.SocialTemplate=Backbone.View.extend({_deletionStatus:"none",_author:void 0,className:"nc-social-template",template:NelioContent.helpers.getTemplate("_nc-social-template"),events:{mouseleave:"_cancelMessageDeletion","click .nc-edit":"_editTemplate","click .nc-actions .nc-delete":"_askForMessageDeletionConfirmation","click .nc-actions .nc-cancel-deletion":"_cancelMessageDeletion","click .nc-actions .nc-do-delete":"_deleteMessage"},initialize:function(){this.render=_.bind(this.render,this),this.listenTo(this.model,"change:author",this._updateAuthorInfo),this._updateAuthorInfo(),this.listenTo(this.model,"change",this.render),this.listenTo(this,"nc:render",this.render),NelioContent.profiles.isReady()||this.listenToOnce(NelioContent.profiles,"nc:ready",this.render)},render:function(){var e=this.model.toJSON();e.deletionStatus=this._deletionStatus,e.addedByCurrentUser=this.model.get("creatorId")===NelioContent.users.current().get("id"),e.textFormatted=_.escape(e.text),e.textFormatted=e.textFormatted.replace(/{(title|excerpt|permalink|tags)}/g,'<span class="nc-tag">{$1}</span>'),"reference"===this.model.get("type")&&(e.textFormatted=e.textFormatted.replace(/{ref:(author|title|twitter|url)}/g,'<span class="nc-tag">{ref:$1}</span>'));var t=this.model.get("postType"),i=this.model.get("postCategory"),n=this.model.get("author"),o=!1;if(e.authorLoading=!1,n&&(this._author.isLoading()?(e.authorLoading=!0,n=0):this._author.get("existsInWordPress")&&(o=_.escape(this._author.get("name")))),e.disabled=!1,"nc_any"===t||_.contains(_.pluck(NelioContent.postTypes,"name"),t)?"post"!==t||"nc_any"===i||_.contains(_.pluck(NelioContent.categories,"name"),i)?n&&!o?(e.application=NelioContent.i18n.templates.disabled,e.disabled=NelioContent.i18n.templates.authorNotFound):e.application="nc_any"!==t||n?"nc_any"===t&&n?NelioContent.i18n.templates.allContentByAuthor.replace("{author}",o):"post"!==t||"nc_any"===i||n?"post"===t&&"nc_any"!==i&&n?NelioContent.i18n.templates.postByAuthorInCategory.replace("{category}",_.find(NelioContent.categories,{name:i}).label).replace("{author}",o):"post"!==t&&n?NelioContent.i18n.templates.contentByAuthor.replace("{type}",_.find(NelioContent.postTypes,{name:t}).labels.plural).replace("{author}",o):_.find(NelioContent.postTypes,{name:t}).labels.plural:NelioContent.i18n.templates.postInCategory.replace("{category}",_.find(NelioContent.categories,{name:i}).label):NelioContent.i18n.templates.allContent:(e.application=NelioContent.i18n.templates.disabled,e.disabled=NelioContent.i18n.templates.postCategoryNotFound):(e.application=NelioContent.i18n.templates.disabled,e.disabled=NelioContent.i18n.templates.postTypeNotFound),"network"===this.model.get("network")){var s=_.findWhere(NelioContent.networkMetas,{id:this.model.get("profileId")});void 0===s?(e.profileNameEscaped="",e.profileNetwork=""):(e.profileNameEscaped=_.escape(s.name),e.profileNetwork=_.escape(s.id)),e.isProfileNetwork=!0}else{var l=NelioContent.profiles.get(this.model.get("profileId"));l?(e.profileNameEscaped=_.escape(l.get("displayName")),e.profileFirstLetter=l.get("firstLetter"),e.profilePhoto=l.get("photo"),e.profileNetwork=l.get("network"),e.isProfileNetwork=!1):(e.profileNameEscaped=NelioContent.i18n.errors.generic.unknownUserName,e.profileFirstLetter="none",e.profilePhoto=!1,e.profileNetwork="unknown",e.isProfileNetwork=!1,e.disabled=!0)}return this.el.innerHTML=this.template(e),e.disabled?this.$el.addClass("nc-disabled"):this.$el.removeClass("nc-disabled"),e.authorLoading||"deleting"===this._deletionStatus?this.$el.addClass("nc-locked"):this.$el.removeClass("nc-locked"),this},getStringForSorting:function(){var e;return"network"===this.model.get("network")?(e=this.model.get("isFallback")?"aa":"ab",e+=_.indexOf(_.pluck(NelioContent.networkMetas,"id"),this.model.get("profileId"))):(e="bb",e+=_.indexOf(_.pluck(NelioContent.networkMetas,"id"),this.model.get("network"))),(e+=this.model.get("profileId")+this.model.get("text")+"-"+this.model.get("creationDate").format()).toLowerCase()},_editTemplate:function(e){e.preventDefault();var t=this,i=new NelioContent.models.SocialTemplate(this.model.toJSON()),n=new NelioContent.views.SocialTemplateEditor({model:i});this.listenToOnce(n,"nc:save:template",function(e){t.model.clearToDefaults().set(e)}),this.listenToOnce(n,"nc:delete:template",function(){t.model.trigger("destroy",t.model)}),n.render()},_askForProfileDeletionConfirmation:function(){return this._deletionStatus="awaiting-confirmation",this.trigger("nc:render"),!1},_cancelProfileDeletion:function(){return"awaiting-confirmation"===this._deletionStatus&&(this._deletionStatus="none",this.trigger("nc:render")),!1},_askForMessageDeletionConfirmation:function(e){e.preventDefault(),this._deletionStatus="awaiting-confirmation",this.trigger("nc:render")},_cancelMessageDeletion:function(e){e.preventDefault(),"awaiting-confirmation"===this._deletionStatus&&(this._deletionStatus="none",this.trigger("nc:render"))},_deleteMessage:function(e){e.preventDefault(),this._deletionStatus="deleting",this.trigger("nc:render"),this.model.destroy({wait:!0})},_updateAuthorInfo:function(){this._author&&(this.stopListening(this._author),this._author=void 0);var e=this.model.get("author");e&&(this._author=NelioContent.users.getUser(e),this._author.isLoading()&&(this.listenToOnce(this._author,"nc:load",this.render),this.listenToOnce(this._author,"nc:load:error",this.render)))},close:function(){this.stopListening(),this.unbind(),void 0!==this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}}),NelioContent.views.SocialTemplateSettings=Backbone.View.extend({_templateViews:[],template:NelioContent.helpers.getTemplate("_nc-social-template-settings"),events:{"click .nc-add-template":"_createTemplate"},initialize:function(){this.render=_.bind(this.render,this),this._addTemplateView=_.bind(this._addTemplateView,this),this._removeTemplateView=_.bind(this._removeTemplateView,this),this._resetTemplateViews=_.bind(this._resetTemplateViews,this),this._sortTemplateViews=_.bind(this._sortTemplateViews,this),this._sortTemplateViewsDebounced=_.debounce(this._sortTemplateViews,200),this._sortTemplateViewsDebounced=_.bind(this._sortTemplateViewsDebounced,this),void 0===this.collection&&(this.collection=new NelioContent.collections.Templates),this._resetTemplateViews(),this.listenTo(this.collection,"reset",this._resetTemplateViews),this.listenTo(this.collection,"add",this._addTemplateView),this.listenTo(this.collection,"remove",this._removeTemplateView),this.listenTo(this,"nc:render",this.render),this.listenTo(this,"nc:sort",this.render)},render:function(){this.el.innerHTML=this.template();var t={publication:{$el:this.$(".nc-publication .nc-social-templates"),hasItems:!1},reshare:{$el:this.$(".nc-reshare .nc-social-templates"),hasItems:!1}};return _.each(this._templateViews,function(e){switch(e.model.get("type")){case"reshare":t.reshare.$el.append(e.render().el),t.reshare.hasItems=!0;break;default:t.publication.$el.append(e.render().el),t.publication.hasItems=!0}},this),_.map(t,function(e){e.hasItems?(e.$el.show(),e.$el.parent().find(".nc-empty").hide()):(e.$el.hide(),e.$el.parent().find(".nc-empty").show())}),this},_createTemplate:function(e){e.preventDefault();var t="publication";-1!==(e.target||e.srcElement).className.indexOf("add-reshare-template")&&(t="reshare");var i=new NelioContent.views.SocialTemplateEditor({model:new NelioContent.models.SocialTemplate({type:t})}),n=this;this.listenToOnce(i,"nc:save:template",function(e){n.collection.add(e)}),i.render()},_addTemplateView:function(e){var t=new NelioContent.views.SocialTemplate({model:e});this._templateViews.push(t),this._sortTemplateViewsDebounced()},_removeTemplateView:function(t){var e=_.filter(this._templateViews,function(e){return e.model.get("id")===t.get("id")},this);if(0<e.length){var i=e[0];this._templateViews=_.without(this._templateViews,i),this.stopListening(i),i.close()}this._templateViews.length||this.trigger("nc:render")},_resetTemplateViews:function(){_.each(this._templateViews,function(e){e.close()},this),this._templateViews=[],this.collection.each(this._addTemplateView)},_sortTemplateViews:function(){this._templateViews.sort(function(e,t){var i=e.getStringForSorting(),n=t.getStringForSorting();return i<n?-1:n<i?1:0}),this.trigger("nc:sort")},close:function(){_.each(this._templateViews,function(e){e.close()},this),this._templateViews=[],this.stopListening(),this.unbind(),void 0!==this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}}),NelioContent.views.UserSelector=Backbone.View.extend({_userOptionTemplate:NelioContent.helpers.getTemplate("_nc-user-selector-option"),_selectedUserTemplate:NelioContent.helpers.getTemplate("_nc-user-selector-selected-option"),_rendered:!1,_defaultValue:void 0,_single:!1,_$select:void 0,_dropdownCssClass:"nc-ncselect2-above-jquery-dialog",_width:"100%",events:{"change .nc-user-selector":"_onUserChange"},initialize:function(e){void 0===e&&(e={}),void 0!==e.defaultValue&&(this._defaultValue=e.defaultValue),"boolean"==typeof e.single&&(this._single=e.single),"object"==typeof e.$select?this._$select=e.$select:this._$select=jQuery('<select class="nc-user-selector"></select>'),"string"==typeof e.dropdownCssClass&&(this._dropdownCssClass=e.dropdownCssClass),"string"==typeof e.width&&(this._width=e.width),this.render=_.bind(this.render,this),this._getAjaxData=_.bind(this._getAjaxData,this),this._processResults=_.bind(this._processResults,this),this._templateResult=_.bind(this._templateResult,this),this._templateSelection=_.bind(this._templateSelection,this)},render:function(){if(this._rendered)return this;this._rendered=!0;var e=[];if("number"==typeof this._defaultValue){var t=NelioContent.users.getUser(this._defaultValue);if(t.isLoading())return this.listenToOnce(t,"nc:load",this.render),this.listenToOnce(t,"nc:load:error",this.render),this._rendered=!1,this;e=[t.toJSON()]}return this.$el.html(this._$select),this._$select.ncselect2({data:e,dropdownCssClass:this._dropdownCssClass,width:this._width,placeholder:NelioContent.i18n.actions.selectAUser,templateResult:this._templateResult,templateSelection:this._templateSelection,ajax:{url:ajaxurl,cache:!1,dataType:"json",delay:250,data:this._getAjaxData,processResults:this._processResults}}),this.setValue(this._defaultValue),this._single&&this._$select.prop("disabled",!0),this},setValue:function(e){if(this._rendered){if("number"==typeof e){var t=_.bind(function(){this.undelegateEvents(),this._$select.empty().html('<option value="'+e+'"></option>').trigger("change"),this.delegateEvents()},this),i=NelioContent.users.getUser(e);i.isLoading()?this.listenToOnce(i,"nc:load",t):t()}}else this._defaultValue=e},lock:function(){this._$select.prop("disabled",!0)},unlock:function(){this._$select.prop("disabled",!1)},clearSelection:function(){this._$select.val(void 0),this._$select.trigger("change")},_getAjaxData:function(e){return{action:"nelio_content_get_authors",term:e.term,page:e.page}},_processResults:function(e,t){t.page=t.page||1;for(var i=0;i<e.items.length;++i)NelioContent.users.add(e.items[i]),e.items[i]=NelioContent.users.get(e.items[i].id).toJSON();return{results:e.items,pagination:{more:e.more}}},_templateResult:function(e){return void 0===e.name?e.text:a(this._userOptionTemplate(e))},_templateSelection:function(e){return isNaN(parseInt(e.id))?e.text:(e=NelioContent.users.getUser(e.id).toJSON(),a(this._selectedUserTemplate(e)))},_onUserChange:function(e){var t=e.target||e.srcElement,i=a(t),n=NelioContent.helpers.trim(i.val());n=isNaN(parseInt(n))?n:parseInt(n),this.trigger("nc:change",n)},close:function(){this._rendered&&this._$select.ncselect2("destroy"),this.stopListening(),this.unbind(),void 0!==this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}}),NelioContent.views.UserFilter=NelioContent.views.UserSelector.extend({_actions:!1,_labels:!1,initialize:function(e){void 0===e.defaultValue&&(e.defaultValue="all"),NelioContent.views.UserSelector.prototype.initialize.call(this,e),this._actions=jQuery.extend({},{all:!0,none:!1},e.actions),this._labels=jQuery.extend({},{group:!1,all:!1,none:!1,single:!1},e.labels),this._getAjaxData=_.bind(this._getAjaxData,this),this._processResults=_.bind(this._processResults,this),this._templateResult=_.bind(this._templateResult,this),this._templateSelection=_.bind(this._templateSelection,this)},render:function(){if(this._rendered)return this;if("number"==typeof this._defaultValue&&0<this._defaultValue){var e=NelioContent.users.getUser(this._defaultValue);e.isLoading()||e.get("existsInWordPress")||(this._defaultValue="all")}return NelioContent.views.UserSelector.prototype.render.call(this),"all"===this._defaultValue?(this._$select.val("all"),this._$select.empty().append('<option value="all">'+_.escape(this._labels.all)+"</option>").trigger("change")):"none"===this._defaultValue&&(this._$select.val("none"),this._$select.empty().append('<option value="none">'+_.escape(this._labels.none)+"</option>").trigger("change")),this},_getAjaxData:function(e){return{action:"nelio_content_get_authors",term:e.term,page:e.page}},_processResults:function(e,t){var i=NelioContent.views.UserSelector.prototype._processResults.call(this,e,t);return this._labels.group&&1===t.page&&i.results.length&&i.results.unshift({text:this._labels.group,children:[]}),t.term=t.term||"",1!==t.page||t.term.length||(this._actions.none&&i.results.unshift({id:"none"}),this._actions.all&&i.results.unshift({id:"all"})),i},_templateResult:function(e){return"all"===e.id?this._actions.all:"none"===e.id?this._actions.none:NelioContent.views.UserSelector.prototype._templateResult.call(this,e)},_templateSelection:function(e){if("all"===e.id)return this._labels.all;if("none"!==e.id)return this._labels.single?"string"==typeof e.name?this._labels.single.replace("%s",e.name):e.text:NelioContent.views.UserSelector.prototype._templateSelection.call(this,e);return a('<span><span class="nc-dashicons nc-dashicons-hidden"></span> '+this._labels.none+"</span>")}}),NelioContent.views.SingleProfileSelector=Backbone.View.extend({_profileTemplate:{default:NelioContent.helpers.getTemplate("_nc-single-profile-selector-profile"),selected:NelioContent.helpers.getTemplate("_nc-single-profile-selector-selected-profile")},_targetTemplate:NelioContent.helpers.getTemplate("_nc-single-profile-selector-target"),_previousTargetName:"",_targetDataLoader:void 0,_rendered:!1,events:{"change select.nc-profile":"_changeProfile","change select.nc-target":"_changeTarget"},initialize:function(){this.render=_.bind(this.render,this),this.listenTo(this.model,"change:profileId",this._changeSelectedProfile),this.listenTo(this.model,"change:profileId",this._fixTargetSelectorVisibility)},render:function(){if(this._rendered)return this;this._rendered=!0;var e=jQuery('<div class="nc-profile-container"></div>'),t=jQuery('<select class="nc-profile" name="profile"></select>');e.html(t),this.$el.html(e);var i=this;t.ncselect2({dropdownCssClass:"nc-ncselect2-above-jquery-dialog",data:NelioContent.profiles.toJSON(),width:"100%",matcher:function(e,t){return"object"!=typeof e||"string"!=typeof e.term?t:(e=e.term,-1!==(t.displayName+" "+t.username).toLowerCase().indexOf(e.toLowerCase())?((t=_(t).clone()).displayNameEscaped=NelioContent.helpers.strongify(_.escape(t.displayName),e),t.usernameEscaped=NelioContent.helpers.strongify(_.escape(t.username),e),t):null)},templateResult:function(e){return void 0===e.displayName?e.text:a(i._profileTemplate.default(e))},templateSelection:function(e){return a(i._profileTemplate.selected(e))}}),t.val(this.model.get("profileId")).trigger("change");var n=jQuery('<div class="nc-target-container"></div>'),o=jQuery('<select class="nc-target" name="target"></select>');return n.html(o),o.hide(),this.$el.append(n),this._fixTargetSelectorVisibility(),this},lock:function(){this._isLocked=!0,this.$("select.nc-profile").prop("disabled",!0),this.$("select.nc-target").prop("disabled",!0)},_changeProfile:function(){this.stopListening(this.model,"change:profileId",this._changeSelectedProfile);var e=NelioContent.profiles.get(NelioContent.helpers.trim(this.$("select.nc-profile").val()));void 0!==e&&this.model.set("profileId",e.get("id")),this.listenTo(this.model,"change:profileId",this._changeSelectedProfile),this._maybeFixNewMessageInfo()},_changeTarget:function(){var e=this.$("select.nc-target"),t=e.val(),i=e.ncselect2("data"),n=_.findWhere(i,{id:t});void 0!==n?(this.model.set("targetName",n.name),this.model.set("targetDisplayName",n.displayName)):(this.model.set("targetName","default"),this.model.set("targetDisplayName","")),this._maybeFixNewMessageInfo()},_changeSelectedProfile:function(){this.stopListening(this.model,"change:profileId",this._changeSelectedProfile),this.$("select").val(this.model.get("profileId")).trigger("change"),this.listenTo(this.model,"change:profileId",this._changeSelectedProfile)},_fixTargetSelectorVisibility:function(){if(this._rendered){var e=this.$(".nc-target");e.ncselect2(),e.ncselect2("destroy"),void 0!==this._targetDataLoader&&("function"==typeof this._targetDataLoader.abort&&this._targetDataLoader.abort(),this._targetDataLoader=void 0);var t=NelioContent.profiles.get(this.model.get("profileId"));if(t.allowsMultiTargets()){var i=_.findWhere(NelioContent.networkMetas,{id:this.model.get("network")}),n=this;e.val(""),e.ncselect2({placeholder:i.multiTargetLabels.loading,width:"100%"}),this._targetDataLoader=a.ajax({url:NelioContent.apiUri+"/profile/"+t.get("id")+"/targets",method:"GET",headers:{Authorization:"Bearer "+NelioContent.apiAuthToken,"Content-Type":"application/json"},success:function(e){n._buildTargetSelector(e),n._targetDataLoader=void 0},error:function(){n._targetDataLoader=void 0}}),this._previousTargetName=this.model.get("targetName"),this.model.set("targetName",""),this.model.set("targetDisplayName","")}else this.model.set("targetName","default"),this.model.set("targetDisplayName","")}},_buildTargetSelector:function(e){var t=this.$(".nc-target"),i=this;if(t.ncselect2({dropdownCssClass:"nc-ncselect2-above-jquery-dialog",width:"100%",data:e,matcher:function(e,t){return"object"!=typeof e||"string"!=typeof e.term?t:(e=e.term,-1!==t.displayName.toLowerCase().indexOf(e.toLowerCase())?((t=_(t).clone()).displayNameEscaped=NelioContent.helpers.strongify(t.displayName,e),t):null)},templateResult:function(e){return void 0===e.displayName?e.text:(void 0===e.displayNameEscaped&&(e.displayNameEscaped=_.escape(e.displayName)),a(i._targetTemplate(e)))},templateSelection:function(e){return void 0!==e.displayName&&void 0===e.displayNamedEscaped&&(e.displayNameEscaped=_.escape(e.displayName)),a(i._targetTemplate(e))}}),!(e.length<=0)){var n=e[0],o=_.findWhere(e,{name:this._previousTargetName});void 0!==o&&(n=o),t.val(n.id).trigger("change"),this._previousTargetName=""}},_maybeFixNewMessageInfo:function(){this.model.isNew()&&this.model.set("profiles",[{id:this.model.get("profileId"),targetName:this.model.get("targetName"),targetDisplayName:this.model.get("targetDisplayName")}])},close:function(){this._rendered&&(this.$("select.nc-profile").ncselect2("destroy"),this.$("select.nc-target").ncselect2(),this.$("select.nc-target").ncselect2("destroy")),this.stopListening(),this.unbind(),void 0!==this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}}),NelioContent.views.SocialTemplateEditor=Backbone.View.extend({_rendered:!1,_views:{profileSelector:void 0,author:void 0},_$window:void 0,_$saveButton:void 0,_closeAndDestroy:!0,_originalProfileCollection:void 0,className:"nc-social-template-editor",template:NelioContent.helpers.getTemplate("_nc-social-template-editor"),events:{"change .nc-post-filter select":"_changePostType","change textarea":"_changeText","keyup  textarea":"_changeText"},initialize:function(){this._$window=a(window),this.render=_.bind(this.render,this),this._onDialogSave=_.bind(this._onDialogSave,this),this._onDialogCancel=_.bind(this._onDialogCancel,this),this._onDialogDelete=_.bind(this._onDialogDelete,this),this._originalProfileCollection=NelioContent.profiles,NelioContent.profiles=new NelioContent.collections.ConnectedSocialProfiles,_.each(NelioContent.networkMetas,function(e){e.allowsMultiTargets||NelioContent.profiles.add({id:e.id,displayName:e.name,network:e.id,kind:"network"})}),NelioContent.profiles.add(this._originalProfileCollection.toJSON()),this._views.profileSelector=new NelioContent.views.SingleProfileSelector({model:this.model});var e=this.model.get("author");e=e||"all",this._views.author=new NelioContent.views.UserFilter({defaultValue:e,actions:{all:NelioContent.i18n.templates.anyAuthorAction},labels:{all:NelioContent.i18n.templates.anyAuthorLabel}}),this.listenTo(this._views.author,"nc:change",this._onAuthorChange),this._convertToDialog(),this.listenTo(this.model,"change",this._maybeEnableSaveButton)},render:function(){if(this._rendered)return this;this._rendered=!0;var e=this.model.toJSON();this._views.author.$el.detach(),this.el.innerHTML=this.template(e),this.$el.find(".nc-author .nc-container").html(this._views.author.render().el),NelioContent.profiles.length&&this.$(".nc-profile-selector").html(this._views.profileSelector.render().$el),this._maybeEnableSaveButton();var t=this.$(".nc-post-filter select");return t.val(this.model.get("postType")),t.val()||t.val(this.model.get("postType")+":"+this.model.get("postCategory")),t.val()||(t.val("nc_any"),this.model.set("postType","nc_any"),this.model.set("postCategory","nc_none")),this},_changeText:function(e){if(!this._isLocked){var t=e.target||e.srcElement,i=a(t);this.stopListening(this.model,"change",this.render),this.model.set("text",NelioContent.helpers.trim(i.val())),this.listenTo(this.model,"change",this.render)}},_changePostType:function(e){if(!this._isLocked){var t=e.target||e.srcElement,i=a(t).val(),n="nc_none";"post"===i?n="nc_any":/^post:/.test(i)&&(n=i.replace(/^post:/,""),i="post"),this.stopListening(this.model,"change",this.render),this.model.set("postType",i),this.model.set("postCategory",n),this.listenTo(this.model,"change",this.render)}},_onAuthorChange:function(e){"all"===e&&(e=0),this.model.set("author",parseInt(e))},_lock:function(){this.$el.addClass("nc-locked"),this._views.profileSelector.lock()},_convertToDialog:function(){var e=[];e.push(NelioContent.helpers.makeDialogCancelButton(this,NelioContent.i18n.actions.cancel)),e.push(NelioContent.helpers.makeDialogSaveButton(this,NelioContent.i18n.actions.save)),this.model.isNew()||e.push(NelioContent.helpers.makeDialogDeleteButton(this,NelioContent.i18n.actions.delLabel));var t=this;this.$el.dialogS2({title:t.model.isNew()?NelioContent.i18n.titles.newTemplate:NelioContent.i18n.titles.editTemplate,buttons:e,draggable:!1,modal:!0,resizable:!1,width:Math.min(600,t._$window.width()-40),dialogClass:"nc-dialog",position:{my:"center top",at:"center top+60"},open:function(){t.listenTo(t,"nc:click:dialog:save",t._onDialogSave),t.listenTo(t,"nc:click:dialog:cancel",t._onDialogCancel),t.listenTo(t,"nc:click:dialog:delete",t._onDialogDelete),t._$saveButton=t.$el.parent().find("button.nc-save-button"),NelioContent.helpers.makeWarningTooltip(t._$saveButton);var e=t.$el.parent().find("button.nc-delete-button");0<e.length&&e.blur()},close:function(){t.stopListening(t,"nc:click:dialog:save",t._onDialogSave),t.stopListening(t,"nc:click:dialog:cancel",t._onDialogCancel),t.stopListening(t,"nc:click:dialog:delete",t._onDialogDelete),t._$saveButton.tooltip("destroy"),t._$saveButton=void 0,t._closeAndDestroy&&(t.$el.dialogS2("destroy"),t.trigger("nc:close:dialog"),t.close())}})},_maybeEnableSaveButton:function(){if(void 0!==this._$saveButton){this._$saveButton.tooltip("close");var e=this.model.isSomethingMissing();e?(this._$saveButton.addClass("button-disabled",!0),this._$saveButton.attr("title",e)):(this._$saveButton.removeClass("button-disabled",!1),this._$saveButton.attr("title",""))}},_onDialogSave:function(){if(!this.model.isSomethingMissing()){var e=this.$el.parent(),t=e.find(".ui-dialog-buttonpane button.button-primary"),i=e.find(".ui-dialog-titlebar button, .ui-dialog-buttonpane button:not( .button-primary )");this._lock(),this.$el.dialogS2("option","closeOnEscape",!1),t.prop("disabled",!0),i.prop("disabled",!0),t.html(NelioContent.i18n.feedback.saving);var n=this;this.model.save(void 0,{success:function(e,t){var i=new NelioContent.models.SocialTemplate(t);n.trigger("nc:save:template",i.toJSON()),n.$el.dialogS2("close")},error:function(e){n.$el.dialogS2("close")}})}},_onDialogCancel:function(){this.$el.dialogS2("close")},_onDialogDelete:function(){var i=this,n=NelioContent.helpers.openDeletionConfirmationDialog(NelioContent.i18n.titles.delSocialTemplate,NelioContent.i18n.dialogs.deleteSocialTemplate,NelioContent.i18n.actions.doDeleteTemplate,function(){var e=n.parent();e.find(".nc-super-delete-button").html(NelioContent.i18n.feedback.deleting),e.find("button").prop("disabled",!0),i.model.destroy({success:function(e,t){n.dialog("destroy"),i.trigger("nc:delete:template",i.model),i.$el.dialogS2("close")}})})},close:function(){NelioContent.profiles=this._originalProfileCollection,_.each(_.values(this._views),function(e){"object"==typeof e&&"function"==typeof e.close&&e.close()}),this.stopListening(),this.unbind(),void 0!==this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}}),c=new NelioContent.views.SocialTemplateSettings({collection:NelioContent.templates}),a("#social-template-settings-container").html(c.render().el)),"feeds"===t&&(NelioContent.models.Feed=Backbone.Model.extend({defaults:function(){return{name:"",url:"",icon:""}},initialize:function(){}}),NelioContent.collections.Feeds=NelioContent.collections.Collection.extend({_isLoading:!1,model:NelioContent.models.Feed,initialize:function(){this.listenTo(this,"add",this._onAdd),this.listenTo(this,"remove",this._onRemove),this.listenTo(this,"reset",this._onReset)},load:function(){this._isLoading=!0,this.trigger("nc:change:isLoading");var t=this;a.ajax({url:ajaxurl,data:{action:"nelio_content_get_feeds"},success:function(e){t._isLoading=!1,t.reset(e)},error:function(e){t.trigger("nc:error",e.responseJSON),t._isLoading=!1,t.trigger("nc:change:isLoading")}})},addFeed:function(e){var i=this;a.ajax({url:ajaxurl,data:{action:"nelio_content_add_feed",url:e},success:function(e){i.add(e),i.trigger("nc:add:done")},error:function(e){var t=NelioContent.i18n.errors.feed.feedError+" "+e.responseJSON;NelioContent.helpers.openErrorDialog(t),i._isLoading=!1,i.trigger("nc:add:done")}})},_onFeedRemove:function(e){var t=this;a.ajax({url:ajaxurl,data:{action:"nelio_content_remove_feed",id:e.get("id")},success:function(){t.remove(e)},error:function(e){var t=NelioContent.i18n.errors.feed.feedError+" "+e.responseJSON;NelioContent.helpers.openErrorDialog(t)}})},isLoading:function(){return this._isLoading},_triggerModelChange:function(e){this.trigger("nc:change:model",this,e)},_onAdd:function(e){this.listenTo(e,"change",this._triggerModelChange),this.listenTo(e,"nc:feed:remove",this._onFeedRemove),this.listenTo(e,"destroy",this.remove)},_onRemove:function(e){this.stopListening(e)},_onReset:function(e,t){_.each(t.previousModels,this._onRemove,this),this.each(this._onAdd,this)}}),NelioContent.views.Feed=Backbone.View.extend({_deletionStatus:"none",className:"nc-feed",template:NelioContent.helpers.getTemplate("_nc-feed"),events:{"click .nc-actions .nc-rename":"_openRenameDialog","click .nc-actions .nc-delete":"_askForFeedDeletionConfirmation","click .nc-actions .nc-cancel-deletion":"_cancelFeedDeletion","click .nc-actions .nc-do-delete":"_deleteFeed"},initialize:function(){this.render=_.bind(this.render,this),this.listenTo(this,"nc:render",this.render),this.listenTo(this.model,"change:name",this.render)},render:function(){var e=this.model.toJSON();return e.deletionStatus=this._deletionStatus,this.el.innerHTML=this.template(e),"deleting"===this._deletionStatus?this.$el.addClass("nc-locked"):this.$el.removeClass("nc-locked"),this},_askForFeedDeletionConfirmation:function(e){e.preventDefault(),this._deletionStatus="awaiting-confirmation",this.trigger("nc:render")},_cancelFeedDeletion:function(e){e.preventDefault(),"awaiting-confirmation"===this._deletionStatus&&(this._deletionStatus="none",this.trigger("nc:render"))},_openRenameDialog:function(e){e.preventDefault();var i=this,n=a('<div><input style="width:100%" type="text" value="'+_.escape(this.model.get("name"))+'" placeholder="Name..." /></div>');n.dialog({title:NelioContent.i18n.titles.renameFeed,modal:!0,width:Math.min(420,a(window).width()-20),dialogClass:"nc-dialog",closeOnEscape:!1,buttons:[NelioContent.helpers.makeDialogButton(this,"rename",NelioContent.i18n.actions.renameFeed,!0)],beforeClose:function(){i.stopListening(i,"nc:click:dialog:rename")}}),this.listenToOnce(this,"nc:click:dialog:rename",function(){var e=n.find("input"),t=n.find("input").val();e.prop("disabled",!0),n.closest(".ui-dialog").find("button").prop("disabled",!0),n.closest(".ui-dialog").find(".nc-rename-button").html(NelioContent.i18n.feedback.renamingFeed),a.ajax({url:ajaxurl,data:{action:"nelio_content_rename_feed",id:i.model.get("id"),name:t},success:function(e){i.model.set(e)},complete:function(){n.dialog("close"),n.remove(),n=void 0}})})},_deleteFeed:function(e){e.preventDefault(),this._deletionStatus="deleting",this.model.trigger("nc:feed:remove",this.model),this.trigger("nc:render")},close:function(){this.stopListening(),this.unbind(),void 0!==this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}}),NelioContent.views.FeedSettings=Backbone.View.extend({_urlMatcher:/^https?:\/\/([\da-z\.-]+)\.([a-z]{2,6})(\/[^\/\s]+)*\/?$/i,_feedViews:[],template:NelioContent.helpers.getTemplate("_nc-feed-settings"),events:{"keypress input[type=url]":"_doNotPropagateEnter","click .nc-add-feed-button":"_addFeed","keyup input[type=url]":"_onUrlChange","change input[type=url]":"_onUrlChange"},initialize:function(){this.render=_.bind(this.render,this),this._addFeedView=_.bind(this._addFeedView,this),this._removeFeedView=_.bind(this._removeFeedView,this),this._resetFeedViews=_.bind(this._resetFeedViews,this),void 0===this.collection&&(this.collection=new NelioContent.collections.Feeds),this._resetFeedViews(),this.listenTo(this.collection,"reset",this._resetFeedViews),this.listenTo(this.collection,"add",this._addFeedView),this.listenTo(this.collection,"remove",this._removeFeedView),this.listenTo(this,"nc:render",this.render),this.listenTo(this.collection,"nc:add:done",this.render)},render:function(){var e={numOfFeeds:this._feedViews.length};this.el.innerHTML=this.template(e);var t=this.$(".nc-feeds");return _.each(this._feedViews,function(e){t.append(e.render().el)},this),this._maybeEnableAddButton(),this},_maybeEnableAddButton:function(){var e=this.$(".nc-feed-add .button"),t=this.$(".nc-feed-url input");return 0===NelioContent.helpers.trim(t.val()).length?(e.removeClass("button-primary").prop("disabled",!0),e.attr("title",NelioContent.i18n.errors.feed.noUrl),!1):this._urlMatcher.test(NelioContent.helpers.trim(t.val()))?(e.addClass("button-primary").prop("disabled",!1),e.attr("title",""),!0):(e.removeClass("button-primary").prop("disabled",!0),e.attr("title",NelioContent.i18n.errors.feed.invalidUrl),!1)},_doNotPropagateEnter:function(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation())},_onUrlChange:function(e){this._maybeEnableAddButton()&&13===e.keyCode&&this._addFeed()},_addFeed:function(){var e=this.$("input[type=url]"),t=e.val();e.val("").trigger("change"),this.$(".nc-add-feed-button").html(NelioContent.i18n.feedback.adding),this.collection.addFeed(t)},_addFeedView:function(e){var t=new NelioContent.views.Feed({model:e});this._feedViews.unshift(t),this.trigger("nc:render")},_removeFeedView:function(t){var e=_.filter(this._feedViews,function(e){return e.model.get("id")===t.get("id")},this);if(0<e.length){var i=e[0];this._feedViews=_.without(this._feedViews,i),this.stopListening(i),i.close()}this._feedViews.length||this.trigger("nc:render")},_resetFeedViews:function(){_.each(this._feedViews,function(e){e.close()},this),this._feedViews=[],this.collection.each(this._addFeedView),this.trigger("nc:render")},close:function(){_.each(this._feedViews,function(e){e.close()},this),this._feedViews=[],this.stopListening(),this.unbind(),void 0!==this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}}),(c=new NelioContent.views.FeedSettings).collection.load(),a("#feed-settings-container").html(c.render().el)),_.contains(["social-profiles","social-templates","feeds"],t)||a("#submit").addClass("settings-ready"),Backbone.listenTo(NelioContent.profiles,"reset",p),Backbone.listenTo(NelioContent.templates,"reset",p),Backbone.listenTo(NelioContent.profiles,"nc:ready",p),Backbone.listenTo(NelioContent.templates,"nc:ready",p),NelioContent.profiles.populate(),NelioContent.templates.populate()}(jQuery);