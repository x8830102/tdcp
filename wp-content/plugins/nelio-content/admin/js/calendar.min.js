!function(c){"use strict";var e,t,i,n;NelioContent.views.PostEditor=Backbone.View.extend({_views:{author:void 0},_suggestedReference:"",_firstEditorialComment:"",_isDatePickerReady:!1,_buttons:void 0,_labels:void 0,_regex:{url:/^(https?:\/\/)?([\da-z\.-]+)\.([a-z]{2,6})(\/[^\/\s]+)*\/?$/i,date:/[12][0-9][0-9][0-9]-[01][0-9]-[0-3][0-9]/,time:/[012][0-9]:[0-5][0-9]/},_originalValues:void 0,model:NelioContent.models.Post,template:NelioContent.helpers.getTemplate("_nc-post-editor"),events:{"change .nc-title":"_onTitleChange","keyup .nc-title":"_onTitleChange","click  .nc-date .nc-value":"_maybeInitDatePicker","change .nc-date":"_onDateChange","change .nc-time":"_onTimeChange","change .nc-post-type":"_onPostTypeChange","keyup .nc-post-type":"_onPostTypeChange","click .nc-toggle-editor-visibility":"_toggleEditorInformationVisibility","change .nc-suggested-reference input":"_onSuggestedReferenceChange","keyup .nc-suggested-reference input":"_onSuggestedReferenceChange","change .nc-initial-comment textarea":"_onFirstEditorialCommentChange","keyup .nc-initial-comment textarea":"_onFirstEditorialCommentChange"},initialize:function(e){if("object"!=typeof e&&(e={}),"string"!=typeof e.date&&(e.date=ncNewLocalMoment().format("YYYY-MM-DD")),"string"==typeof e.suggestedReference&&e.suggestedReference.length&&(this._suggestedReference=e.suggestedReference),this.render=_.bind(this.render,this),this._onDialogSave=_.bind(this._onDialogSave,this),this._onDialogCancel=_.bind(this._onDialogCancel,this),this._onDialogDelete=_.bind(this._onDialogDelete,this),this._onDialogViewPost=_.bind(this._onDialogViewPost,this),this._onDialogEditPost=_.bind(this._onDialogEditPost,this),this.listenTo(this,"nc:render",this.render),this.listenTo(this.model,"change:type",this._updateLabels),this._updateLabels(),0===this.model.get("id"))this.model.set("author",NelioContent.users.current().get("id")),this.model.set("localDate",e.date),this.model.set("localTime",ncstore.get("nc-default-post-time["+NelioContent.wpBlogId+"]","10:00")),this.listenTo(this.model,"change",this._maybeEnableSaveButton),this.listenTo(this,"nc:change:suggestedReference",this._maybeEnableSaveButton),this.listenTo(this,"nc:change:firstEditorialComment",this._maybeEnableSaveButton);else{var t=this.model.get("date");t?(this.model.set("localDate",t.format("YYYY-MM-DD")),this.model.set("localTime",t.format("HH:mm"))):(this.model.set("localDate",""),this.model.set("localTime","")),this._originalValues={title:this.model.get("title"),author:this.model.get("author"),date:this.model.get("localDate"),time:this.model.get("localTime")},this.listenTo(this.model,"change",this._showProperButtonSet),this.listenTo(this.model,"change",this._maybeEnableSaveButton)}this._views.author=new NelioContent.views.UserSelector({defaultValue:this.model.get("author")}),this.listenTo(this._views.author,"nc:change",this._onAuthorChange),this.listenTo(this,"nc:close:dialog",this.close),this._convertToDialog()},render:function(){var e=this.$(".nc-date .nc-value");"date"!==e.prop("type")&&(e.datepicker("destroy"),this._isDatePickerReady=!1);var t=this.model.toJSON();t.isEditorInformationVisible=ncstore.get("nc-is-calendar-editor-info-visible["+NelioContent.wpBlogId+"]",!1),t.suggestedReference=this._suggestedReference,t.editorialComment=this._firstEditorialComment,t.today=ncNewLocalMoment().format("YYYY-MM-DD"),this._views.author.$el.detach(),this.el.innerHTML=this.template(t),"post"===t.type?this.$(".nc-post-type").val("post:"+t.categories[0]):this.$(".nc-post-type").val(t.type),this.$el.dialogS2("open"),this.$(".nc-author .nc-field").html(this._views.author.render().$el),this._views.author.$el.trigger("change");var i=NelioContent.users.current().get("role");return"administrator"===i||"editor"===i?this._views.author.unlock():this._views.author.lock(),this._maybeEnableSaveButton(),this},_lock:function(){this.$("*").attr("disabled","disabled"),this.$el.addClass("nc-locked")},_unlock:function(){this.$("*").removeAttr("disabled"),this.$el.removeClass("nc-locked")},_convertToDialog:function(){var e=[];0===this.model.get("id")?(e.push(NelioContent.helpers.makeDialogCancelButton(this,NelioContent.i18n.actions.cancel)),e.push(NelioContent.helpers.makeDialogSaveButton(this,this._labels.addAction))):(e.push(NelioContent.helpers.makeDialogDeleteButton(this,NelioContent.i18n.actions.trash)),e.push(NelioContent.helpers.makeDialogButton(this,"close",NelioContent.i18n.actions.close)),e.push(NelioContent.helpers.makeDialogButton(this,"view",this._labels.viewAction)),e.push(NelioContent.helpers.makeDialogButton(this,"edit",this._labels.editAction,!0)),e.push(NelioContent.helpers.makeDialogCancelButton(this,NelioContent.i18n.actions.cancel)),e.push(NelioContent.helpers.makeDialogSaveButton(this,NelioContent.i18n.actions.saveChanges)));var i=this;this.$el.dialogS2({title:0<this.model.get("id")?this._labels.editTitle:this._labels.addTitle,autoOpen:!1,buttons:e,dialogClass:"nc-dialog nc-post-editor-dialog",draggable:!1,modal:!0,resizable:!1,width:"95%",position:{my:"center top",at:"center top+60"},open:function(){i.listenTo(i,"nc:click:dialog:save",i._onDialogSave),i.listenTo(i,"nc:click:dialog:cancel",i._onDialogCancel),i.listenTo(i,"nc:click:dialog:delete",i._onDialogDelete),i.listenTo(i,"nc:click:dialog:close",i._onDialogCancel),i.listenTo(i,"nc:click:dialog:view",i._onDialogViewPost),i.listenTo(i,"nc:click:dialog:edit",i._onDialogEditPost),i._buttons=i._buttons||{},i._buttons.edit=i.$el.parent().find("button.nc-edit-button"),i._buttons.view=i.$el.parent().find("button.nc-view-button"),i._buttons.close=i.$el.parent().find("button.nc-close-button"),i._buttons.cancel=i.$el.parent().find("button.nc-cancel-button"),i._buttons.save=i.$el.parent().find("button.nc-save-button"),NelioContent.helpers.makeWarningTooltip(i._buttons.save),0<i.model.get("id")&&(i._buttons.cancel.hide(),i._buttons.save.hide());var e=i.$el.parent().find("button.nc-delete-button");0<e.length&&e.blur()},close:function(e,t){i.stopListening(i,"nc:click:dialog:save",i._onDialogSave),i.stopListening(i,"nc:click:dialog:cancel",i._onDialogCancel),i.stopListening(i,"nc:click:dialog:delete",i._onDialogDelete),i._buttons.save.tooltip("destroy"),i.$el.dialogS2("destroy"),i.trigger("nc:close:dialog")}}),this.listenTo(this,"nc:change:labels",this._renderLabels)},_showProperButtonSet:function(){var e=!1;(e=(e=(e=(e=(e=e||this.model.get("author")!==this._originalValues.author)||this.model.get("title")!==this._originalValues.title)||this.model.get("author")!==this._originalValues.author)||this.model.get("localDate")!==this._originalValues.date)||this.model.get("localTime")!==this._originalValues.time)?(this._buttons.edit.hide(),this._buttons.view.hide(),this._buttons.close.hide(),this._buttons.cancel.show(),this._buttons.save.show()):(this._buttons.edit.show(),this._buttons.view.show(),this._buttons.close.show(),this._buttons.cancel.hide(),this._buttons.save.hide())},_maybeEnableSaveButton:function(){if(void 0!==this._buttons.save){if(this._buttons.save.tooltip("close"),0===NelioContent.helpers.trim(this.model.get("title")).length)return this._buttons.save.addClass("button-disabled"),void this._buttons.save.attr("title",NelioContent.i18n.errors.post.noTitle);if(NelioContent.helpers.trim(this.model.get("localDate")).length&&!this._regex.date.test(this.model.get("localDate")))return this._buttons.save.addClass("button-disabled"),void this._buttons.save.attr("title",NelioContent.i18n.errors.datetime.invalidDate);if(NelioContent.helpers.trim(this.model.get("localDate")).length&&0===NelioContent.helpers.trim(this.model.get("localTime")).length)return this._buttons.save.addClass("button-disabled"),void this._buttons.save.attr("title",NelioContent.i18n.errors.datetime.noTime);if(NelioContent.helpers.trim(this.model.get("localDate")).length&&!this._regex.time.test(this.model.get("localTime")))return this._buttons.save.addClass("button-disabled"),void this._buttons.save.attr("title",NelioContent.i18n.errors.datetime.invalidTime);if(0<this._suggestedReference.length&&!this._regex.url.test(this._suggestedReference))return this._buttons.save.addClass("button-disabled"),void this._buttons.save.attr("title",NelioContent.i18n.errors.post.invalidUrl);this._buttons.save.removeClass("button-disabled"),this._buttons.save.attr("title","")}},_updateLabels:function(){var i=this.model.get("type"),e=_.reduce(NelioContent.postTypes,function(e,t){return i===t.name?t:e});this._labels=e.labels,this.trigger("nc:change:labels")},_renderLabels:function(){var e=this.$el.parent();e.find(".ui-dialog-buttonpane button.nc-save-button").html(this._labels.addAction),e.find(".ui-dialog-buttonpane button.nc-view-button").html(this._labels.viewAction),e.find(".ui-dialog-titlebar .ui-dialog-title").html(this._labels.addTitle)},_onTitleChange:function(e){var t=e.target||e.srcElement,i=c(t);this.model.set("title",NelioContent.helpers.trim(i.val()))},_onPostTypeChange:function(e){var t=e.target||e.srcElement,i=c(t).val();0===i.indexOf("post:")?(i=i.split(":"),this.model.set("type",i[0]),this.model.set("categories",[parseInt(i[1])])):(this.model.set("type",i),this.model.set("categories",[]))},_onAuthorChange:function(e){this.model.set("author",parseInt(e))},_onDateChange:function(e){var t=e.target||e.srcElement,i=c(t);this.model.set("localDate",NelioContent.helpers.trim(i.val()))},_onTimeChange:function(e){var t=e.target||e.srcElement,i=c(t);this.model.set("localTime",NelioContent.helpers.trim(i.val()))},_onSuggestedReferenceChange:function(e){var t=e.target||e.srcElement,i=c(t);this._suggestedReference=i.val(),this.trigger("nc:change:suggestedReference",this._suggestedReference)},_onFirstEditorialCommentChange:function(e){var t=e.target||e.srcElement,i=c(t);this._firstEditorialComment=i.val(),this.trigger("nc:change:firstEditorialComment",this._firstEditorialComment)},_toggleEditorInformationVisibility:function(){var e=ncstore.get("nc-is-calendar-editor-info-visible["+NelioContent.wpBlogId+"]",!1);ncstore.set("nc-is-calendar-editor-info-visible["+NelioContent.wpBlogId+"]",!e),this.trigger("nc:render")},_onDialogSave:function(){var e=this.$el.parent(),t=e.find(".ui-dialog-buttonpane button.nc-save-button"),i=e.find(".ui-dialog-titlebar button, .ui-dialog-buttonpane button:not( .nc-save-button )");if(!t.hasClass("button-disabled")){this._lock(),this.$el.dialogS2("option","closeOnEscape",!1),t.prop("disabled",!0),i.prop("disabled",!0),0===this.model.get("id")?t.html(NelioContent.i18n.feedback.creating):t.html(NelioContent.i18n.feedback.saving);var n={title:this.model.get("title"),author:this.model.get("author"),postType:this.model.get("type"),localDatetime:""};NelioContent.helpers.trim(this.model.get("localDate")).length&&(n.localDatetime=this.model.get("localDate")+" "+this.model.get("localTime")),this.model.get("categories").length&&(n.postCategory=this.model.get("categories")[0]),0===this.model.get("id")?(n.action="nelio_content_create_post_in_calendar",n.reference=NelioContent.helpers.trim(this._suggestedReference),n.comment=NelioContent.helpers.trim(this._firstEditorialComment)):(n.action="nelio_content_update_post_in_calendar",n.post=this.model.get("id"));var s=this;c.ajax({url:ajaxurl,method:"POST",data:n,success:function(e){if("object"==typeof e){var t=new NelioContent.models.Post(e);s.model.set(t.toJSON())}ncstore.set("nc-default-post-time["+NelioContent.wpBlogId+"]",s.model.get("localTime")),s.trigger("nc:save:post",s.model),s.$el.dialogS2("close")},error:function(e){NelioContent.helpers.openErrorDialog(e.responseJSON),t.prop("disabled",!1),i.prop("disabled",!1),0===s.model.get("id")?t.html(s._labels.addAction):t.html(NelioContent.i18n.actions.save),s.$el.dialogS2("option","closeOnEscape",!0),s._unlock()}})}},_onDialogCancel:function(){this.$el.dialogS2("close")},_onDialogDelete:function(){var t=this,e=NelioContent.i18n.titles.trashPost,i=NelioContent.i18n.dialogs.trashPost,n=NelioContent.i18n.actions.doTrashPost;"post"!==this.model.get("type")&&(e=NelioContent.i18n.titles.trashElement,i=NelioContent.i18n.dialogs.trashElement,n=NelioContent.i18n.actions.doTrashElement);var s=NelioContent.helpers.openDeletionConfirmationDialog(e,i,n,function(){var e=s.parent();e.find(".nc-super-delete-button").html(NelioContent.i18n.feedback.trashing),e.find("button").prop("disabled",!0),t.listenTo(t.model,"nc:trash",function(){s.dialog("destroy"),t.trigger("nc:trash:post"),t.$el.dialogS2("close")}),t.model.trash()})},_onDialogViewPost:function(e){e.ctrlKey||2===e.which?window.open(this.model.get("permalink")):window.document.location.href=this.model.get("permalink")},_onDialogEditPost:function(e){e.ctrlKey||2===e.which?window.open(this.model.get("editLink")):window.document.location.href=this.model.get("editLink")},_maybeInitDatePicker:function(e){var t=this.$(".nc-date .nc-value");this._isDatePickerReady||"date"===t.prop("type")||(t.datepicker({dateFormat:"yy-mm-dd",minDate:0}),t.datepicker("show")),this._isDatePickerReady=!0},close:function(){_.each(_.values(this._views),function(e){"object"==typeof e&&"function"==typeof e.close&&e.close()}),this.stopListening(),this.unbind(),void 0!==this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}}),NelioContent.views.TaskDialog=Backbone.View.extend({_rendered:!1,_views:{assignee:void 0},_$saveButton:void 0,_$colors:void 0,_regex:{date:/[12][0-9][0-9][0-9]-[01][0-9]-[0-3][0-9]/,number:/[0-9]+/},model:NelioContent.models.EditorialTask,template:NelioContent.helpers.getTemplate("_nc-task-dialog"),events:{"change .nc-task-description":"_onTaskChange","keyup .nc-task-description":"_onTaskChange","change .nc-date":"_onDateChange"},initialize:function(e){"object"!=typeof e&&(e={}),"string"!=typeof e.date&&(e.date=ncNewLocalMoment().format("YYYY-MM-DD")),this.render=_.bind(this.render,this),this._onDialogSave=_.bind(this._onDialogSave,this),this._onDialogCancel=_.bind(this._onDialogCancel,this),this.listenTo(this.model,"change",this._maybeEnableSaveButton),this.model.set("dateType","exact"),this.model.set("dateValue",e.date),this._views.assignee=new NelioContent.views.UserSelector({defaultValue:this.model.get("assigneeId")}),this._views.date=new NelioContent.views.DateSelector({model:this.model}),this.listenTo(this._views.assignee,"nc:change",this._onAssigneeChange),this.listenTo(this,"nc:close:dialog",this.close),this._convertToDialog()},render:function(){if(this._rendered)return this;this._rendered=!0;var e=this.model.toJSON();return e.today=ncNewLocalMoment().format("YYYY-MM-DD"),this.el.innerHTML=this.template(e),this.$el.dialogS2("open"),this.$(".nc-assignee .nc-field").html(this._views.assignee.render().$el),this._views.assignee.$el.trigger("change"),this._$colors=this.$(".nc-colors"),this._$colors.detach(),this.$el.closest(".ui-dialog").find(".ui-dialog-buttonpane").append(this._$colors),this._$colors.find(".nc-color").on("click",_.bind(this._changeColor,this)),this._maybeEnableSaveButton(),this},_lock:function(){this.$("*").attr("disabled","disabled"),this.$el.addClass("nc-locked")},_unlock:function(){this.$("*").removeAttr("disabled"),this.$el.removeClass("nc-locked")},_convertToDialog:function(){var e=[];e.push(NelioContent.helpers.makeDialogCancelButton(this,NelioContent.i18n.actions.cancel)),e.push(NelioContent.helpers.makeDialogSaveButton(this,NelioContent.i18n.actions.createTask));var t=this;this.$el.dialogS2({title:NelioContent.i18n.titles.newTask,autoOpen:!1,buttons:e,dialogClass:"nc-dialog nc-new-task-dialog",draggable:!1,modal:!0,resizable:!1,width:"95%",position:{my:"center bottom",at:"center center"},open:function(){t.listenTo(t,"nc:click:dialog:save",t._onDialogSave),t.listenTo(t,"nc:click:dialog:cancel",t._onDialogCancel),t._$saveButton=t.$el.parent().find("button.nc-save-button"),NelioContent.helpers.makeWarningTooltip(t._$saveButton)},close:function(){t.stopListening(t,"nc:click:dialog:save",t._onDialogSave),t.stopListening(t,"nc:click:dialog:cancel",t._onDialogCancel),t._$saveButton.tooltip("destroy"),t.$el.dialogS2("destroy"),t.trigger("nc:close:dialog")}})},_maybeEnableSaveButton:function(){if(void 0!==this._$saveButton){if(this._$saveButton.tooltip("close"),0===NelioContent.helpers.trim(this.model.get("task")).length)return this._$saveButton.addClass("button-disabled"),void this._$saveButton.attr("title",NelioContent.i18n.errors.task.noTask);if(0===NelioContent.helpers.trim(this.model.get("dateValue")).length)return this._$saveButton.addClass("button-disabled"),void this._$saveButton.attr("title",NelioContent.i18n.errors.datetime.noDate);if(!this._regex.date.test(this.model.get("dateValue")))return this._$saveButton.addClass("button-disabled"),void this._$saveButton.attr("title",NelioContent.i18n.errors.datetime.invalidDate);this._$saveButton.removeClass("button-disabled"),this._$saveButton.attr("title","")}},_onTaskChange:function(e){var t=e.target||e.srcElement,i=c(t);this.model.set("task",NelioContent.helpers.trim(i.val()))},_onAssigneeChange:function(e){this.model.set("assigneeId",e)},_onDateChange:function(e){var t=e.target||e.srcElement,i=c(t);this.model.set("dateValue",NelioContent.helpers.trim(i.val()))},_changeColor:function(e){if(e.preventDefault(),this._$colors){var t=e.target||e.srcElement,i=c(t);if(i.data("color")===this.model.get("color"))return i.removeClass("nc-selected"),void this.model.set("color","none");this._$colors.find(".nc-color").removeClass("nc-selected"),this.model.set("color",i.data("color")),this._$colors.find(".nc-color.nc-"+this.model.get("color")).addClass("nc-selected")}},_onDialogSave:function(){var e=this.$el.parent(),t=e.find(".ui-dialog-buttonpane button.button-primary"),i=e.find(".ui-dialog-titlebar button, .ui-dialog-buttonpane button:not( .button-primary )");if(!t.hasClass("button-disabled")){this._lock(),this.$el.dialogS2("option","closeOnEscape",!1),t.prop("disabled",!0),i.prop("disabled",!0),t.html(NelioContent.i18n.feedback.creatingTask);var n=this;this.model.save(void 0,{success:function(e,t){n.trigger("nc:save:task",t),n.$el.dialogS2("close")},error:function(e){NelioContent.helpers.openErrorDialog(e.responseJSON),t.html(NelioContent.i18n.actions.createTask),t.prop("disabled",!1),i.prop("disabled",!1),n.$el.dialogS2("option","closeOnEscape",!0),n._unlock()}})}},_onDialogCancel:function(){this.$el.dialogS2("close")},close:function(){_.each(_.values(this._views),function(e){"object"==typeof e&&"function"==typeof e.close&&e.close()}),this.stopListening(),this.unbind(),void 0!==this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}}),NelioContent.views.CalendarItem=Backbone.View.extend({_isAutoLocked:!1,_isLocked:!1,_isHighlighted:!1,_isBlurred:!1,_isDraggable:!1,_isDraggableReady:!1,_isClickable:!1,_calendarItem:!1,_$dragContainment:!1,_postTemplate:NelioContent.helpers.getTemplate("_nc-post-item"),_socialTemplate:NelioContent.helpers.getTemplate("_nc-social-item"),_taskTemplate:NelioContent.helpers.getTemplate("_nc-task-item"),events:{"mouseenter .nc-calendar-item > .nc-content:not( .nc-content-locked )":"_onMouseEnter","mouseleave .nc-calendar-item > .nc-content:not( .nc-content-locked )":"_onMouseLeave","mousedown .nc-calendar-item > .nc-content:not( .nc-content-locked )":"_maybeMakeDraggable","click .nc-calendar-item > .nc-content.nc-content-locked.nc-sent-social-message":"_onClick","click .nc-calendar-item > .nc-content:not( .nc-content-locked )":"_onClick"},initialize:function(e){this._checkUserPermissions(),this.render=_.bind(this.render,this),this.listenTo(this,"nc:render",this.render),this.listenTo(this.model,"change",this.render),this._$dragContainment=e.$containment,NelioContent.profiles.isReady()||this.listenToOnce(NelioContent.profiles,"nc:ready",this.render)},_maybeMakeDraggable:function(e){if(!this._isDraggableReady){this._isDraggableReady=!0;var t=this;this._isDraggable&&(this.$el.addClass("nc-draggable-calendar-item"),this.$el.draggable({appendTo:t._$dragContainment,containment:t._$dragContainment,refreshPositions:!0,scroll:!1,start:function(){c(this).css("visibility","hidden"),t.trigger("nc:drag:start",t.model,t)},stop:function(){c(this).css("visibility",""),t.trigger("nc:drag:stop",t.model,t)},helper:function(){var e=c(this).clone();return e.detach(),t._$dragContainment.append(e),e.css("z-index","999"),e.width(c(this).width()),e.height(c(this).height()),e}}),e.type="mousedown.draggable",e.target=this.el,this.$el.trigger(e))}},render:function(){if(!NelioContent.profiles.isReady())return this.$el.empty(),this;var e;switch(this.model.get("calendarKind")){case"post":(e=this.model.toJSON()).categories=_.reduce(e.categories,function(e,t){return e+(t.name+", ")},"").slice(0,-2);var i=this.model;e.typeLabel=_.reduce(NelioContent.postTypes,function(e,t){return t.name===i.get("type")?t.labels.singular:e},"Post");var t=NelioContent.users.getUser(this.model.get("author"));t.isLoading()&&this.listenToOnce(t,"nc:load",_.bind(function(){this.trigger("nc:render")},this)),e.photo=t.get("photo"),e.displayNameEscaped=_.escape(t.get("name")),e.firstLetter=t.get("firstLetter"),this.el.innerHTML=this._postTemplate(e);break;case"social":(e=this.model.toJSON()).textPreviewEscaped=this.model.getPreviewTextForCalendar();var n=NelioContent.profiles.get(this.model.get("profileId"));n?(e.photo=n.get("photo"),e.displayNameEscaped=_.escape(n.get("displayNameEscaped")),e.firstLetter=n.get("firstLetter")):(e.photo="",e.displayNameEscaped=_.escape(NelioContent.i18n.errors.generic.unknownUserName),e.firstLetter="unknown"),this.el.innerHTML=this._socialTemplate(e),this.$(".nc-calendar-item").addClass("nc-"+this.model.get("network"));break;case"task":e=this.model.toJSON();var s=NelioContent.users.getUser(this.model.get("assigneeId"));s.isLoading()&&this.listenToOnce(s,"nc:load",_.bind(function(){this.trigger("nc:render")},this)),e.photo=s.get("photo"),e.displayNameEscaped=_.escape(s.get("name")),e.firstLetter=s.get("firstLetter"),this.el.innerHTML=this._taskTemplate(e)}return this._calendarItem=this.$(".nc-calendar-item .nc-content")[0],this._fixUIProperties(),this.homogenize(),this},_fixUIProperties:function(){if(this.$el&&(this._isDraggableReady&&this._isDraggable&&(this._isLocked?this.$el.draggable("disable"):this.$el.draggable("enable")),"object"==typeof this._calendarItem)){var e=this._calendarItem.className;e=(e=(e=(e=(e=e.replace(" nc-content-locked-and-highlighted","")).replace(" nc-sent-social-message","")).replace(" nc-content-highlight","")).replace(" nc-content-blurred","")).replace(" nc-content-locked",""),!this._isLocked&&this._isAutoLocked&&this._isHighlighted?e+=" nc-content-locked-and-highlighted":this._isSentSocialMessageAutoLocked()?e+=" nc-content-locked nc-sent-social-message":this._isLocked||this._isAutoLocked?e+=" nc-content-locked":this._isHighlighted?e+=" nc-content-highlight":this._isBlurred&&(e+=" nc-content-blurred"),this._calendarItem.className=e}},homogenize:function(){var e="publish"===this.model.get("status");this._isBlurred===e&&!1===this._isHighlighted||(this._isBlurred=e,this._isHighlighted=!1,this._fixUIProperties())},highlight:function(){var e="post"!==this.model.get("calendarKind")&&"publish"===this.model.get("status");this._isBlurred===e&&!0===this._isHighlighted||(this._isBlurred=e,this._isHighlighted=!0,this._fixUIProperties())},blur:function(){this._isBlurred&&!this._isHighlighted||(this._isBlurred=!0,this._isHighlighted=!1,this._fixUIProperties())},lock:function(){this._isLocked||(this._isLocked=!0,this._fixUIProperties())},unlock:function(){this._isLocked&&(this._isLocked=!1,this._fixUIProperties())},_isSentSocialMessageAutoLocked:function(){return this._isAutoLocked&&"social"===this.model.get("calendarKind")&&"publish"===this.model.get("status")},_checkUserPermissions:function(){var e=NelioContent.users.current().get("id"),t=NelioContent.users.current().get("role");switch(this.model.get("calendarKind")){case"post":this._isClickable=!0,"publish"===this.model.get("status")?this._isDraggable=!1:this._isDraggable="contributor"!==t&&("author"!==t||e===this.model.get("author"));break;case"social":this._isClickable="contributor"!==t&&"publish"!==this.model.get("status"),this._isDraggable="contributor"!==t&&"publish"!==this.model.get("status"),NelioContent.profiles.get(this.model.get("profileId"))||(this._isClickable=!1,this._isDraggable=!1),this.model.get("isFreePreview")&&(this._isDraggable=!1);break;case"task":"contributor"===t?(this._isClickable=e===this.model.get("assigneeId"),this._isDraggable=!1):"author"===t?(this._isClickable=e===this.model.get("assigneeId"),this._isDraggable=e===this.model.get("assigneeId")):(this._isClickable=!0,this._isDraggable=!0)}this._isAutoLocked=!this._isDraggable&&!this._isClickable},_onMouseEnter:function(){switch(this.model.get("calendarKind")){case"post":this.trigger("nc:enter:mouse",this.model.get("id"),this.model.get("id"));break;default:this.trigger("nc:enter:mouse",this.model.get("id"),this.model.get("postId"))}},_onMouseLeave:function(){switch(this.model.get("calendarKind")){case"post":this.trigger("nc:leave:mouse",this.model.get("id"));break;default:this.trigger("nc:leave:mouse",this.model.get("postId"))}},_onClick:function(){if(this._isSentSocialMessageAutoLocked()){var e=_.escape(this.model.get("text"));return e=e.replace(/{([a-z]+)}/g,"<code>{$1}</code>"),void NelioContent.helpers.openDialog(NelioContent.i18n.titles.socialMessage,"<div>"+e+"</div>")}this._isLocked||this._isClickable&&this.trigger("nc:click",this.model)},close:function(){this.stopListening(),this.unbind(),void 0!==this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}}),NelioContent.views.CalendarMoreSocial=Backbone.View.extend({_isPastDay:!1,_isCollapsed:!0,_isAutoLocked:!1,_isLocked:!1,_isHighlighted:!1,_isBlurred:!1,_calendarItem:!1,_postTemplate:NelioContent.helpers.getTemplate("_nc-post-item"),_socialTemplate:NelioContent.helpers.getTemplate("_nc-social-item"),_taskTemplate:NelioContent.helpers.getTemplate("_nc-task-item"),count:0,events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave","click .nc-calendar-item > .nc-content:not( .nc-content-locked )":"_onClick"},initialize:function(e){this.render=_.bind(this.render,this),this.listenTo(this,"nc:render",this.render),NelioContent.profiles.isReady()||this.listenToOnce(NelioContent.profiles,"nc:ready",this.render)},render:function(){if(!NelioContent.profiles.isReady())return this.$el.empty(),this;var e=NelioContent.i18n.sentMessagesInCalendar.length;return 0<this.count?(this._isCollapsed?this._isPastDay?this.count>=e?(this.$el.html('<div class="nc-calendar-item nc-sent-social nc-collapsed"><div class="nc-content"></div></div>'),this.$(".nc-content").html(NelioContent.i18n.sentMessagesInCalendar[e-1].replace("{count}",this.count))):(this.$el.html('<div class="nc-calendar-item nc-sent-social nc-collapsed"><div class="nc-content"></div></div>'),this.$(".nc-content").html(NelioContent.i18n.sentMessagesInCalendar[this.count-1])):(this.$el.html('<div class="nc-calendar-item nc-sent-social nc-collapsed"><div class="nc-content"></div></div>'),this.$(".nc-content").html(NelioContent.i18n.moreMessagesInCalendar.replace("{count}",this.count))):(this.$el.html('<div class="nc-calendar-item nc-sent-social nc-expanded"><div class="nc-content"></div></div>'),this.$(".nc-content").html(NelioContent.i18n.actions.collapseMoreMessages)),this._calendarItem=this.$el.find(".nc-content")[0]):this.$el.empty(),this._fixUIProperties(),this.homogenize(),this},_fixUIProperties:function(){if("object"==typeof this._calendarItem){var e=this._calendarItem.className;e=(e=(e=(e=e.replace(" nc-content-locked-and-highlighted","")).replace(" nc-content-highlight","")).replace(" nc-content-blurred","")).replace(" nc-content-locked",""),!this._isLocked&&this._isAutoLocked&&this._isHighlighted?e+=" nc-content-locked-and-highlighted":this._isLocked||this._isAutoLocked?e+=" nc-content-locked":this._isHighlighted?e+=" nc-content-highlight":this._isBlurred&&(e+=" nc-content-blurred"),this._calendarItem.className=e}},setCount:function(e){this.count=e,this._isCollapsed||e||(this._isCollapsed=!0),this.trigger("nc:render")},homogenize:function(){!0===this._isBlurred&&!1===this._isHighlighted||(this._isBlurred=!0,this._isHighlighted=!1,this._fixUIProperties())},highlight:function(){!0===this._isBlurred&&!0===this._isHighlighted||(this._isBlurred=!0,this._isHighlighted=!0,this._fixUIProperties())},blur:function(){this._isBlurred&&!this._isHighlighted||(this._isBlurred=!0,this._isHighlighted=!1,this._fixUIProperties())},lock:function(){this._isLocked||(this._isLocked=!0,this._fixUIProperties())},unlock:function(){this._isLocked&&(this._isLocked=!1,this._fixUIProperties())},isPastDay:function(e){return"boolean"==typeof e&&(this._isPastDay=e),this._isPastDay},_onClick:function(){this._isLocked||(this._isCollapsed=!this._isCollapsed,this.trigger("nc:render"),this.trigger("nc:click"))},_onMouseEnter:function(){this.highlight()},_onMouseLeave:function(){this.blur()},close:function(){this.stopListening(),this.unbind(),void 0!==this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}}),jQuery,NelioContent.views.CalendarDay=function(e,t){this.calendar=e,this.$el=t,this._date="",this._views={},this._items=[],this._collapsableStatuses=["publish","draft","schedule"],this._moreSocialView=new NelioContent.views.CalendarMoreSocial,this._moreSocialView.render(),this._minNumOfNonCollapsableItems=5,this.render=_.bind(_.debounce(this.render,0),this),this.sortItems=_.bind(_.debounce(this.sortItems,0),this),Backbone.listenTo(this._moreSocialView,"nc:click",this.render)},NelioContent.views.CalendarDay.prototype.render=function(){var i=this.$el.find(".nc-items");i.find("> *").detach();var n=0;_.each(this._items,function(e){if(this.calendar.collection.applyFilters(e)){var t;if("social"===e.get("calendarKind"))return _.contains(this._collapsableStatuses,e.get("status"))?++n<=this._minNumOfNonCollapsableItems||!this._moreSocialView._isCollapsed?(e.completeInitialization(),void((t=this._getView(e))&&i.append(t.el))):void 0:(e.completeInitialization(),void((t=this._getView(e))&&i.append(t.el)));(t=this._getView(e))&&i.append(t.el)}},this),this._updateHiddenItemsCount(),i.append(this._moreSocialView.$el)},NelioContent.views.CalendarDay.prototype._getView=function(e){var t=this._getViewKey(e),i=this._views[t]||this.calendar.createItemView(e);return i&&(this._views[t]=i),i},NelioContent.views.CalendarDay.prototype._getViewKey=function(e){return e.get("calendarKind")+e.get("id")},NelioContent.views.CalendarDay.prototype.setDate=function(e){if(this._date!==e){_.each(this._items,function(e){this.removeItem(e)},this);var t=ncNewLocalMoment().startOf("day"),i=ncNewLocalMoment(e+"T00:00:00.000Z");this._date=e,this._moreSocialView.isPastDay(i.isBefore(t)),this._moreSocialView.isPastDay(),this._minNumOfNonCollapsableItems=10}},NelioContent.views.CalendarDay.prototype.getDate=function(){return this._date},NelioContent.views.CalendarDay.prototype.getMoreSocialView=function(){return this._moreSocialView},NelioContent.views.CalendarDay.prototype.getViews=function(){return this._views},NelioContent.views.CalendarDay.prototype.addItem=function(e){_.contains(this._items,e)||this._items.push(e)},NelioContent.views.CalendarDay.prototype.addItemAndGenerateView=function(e){this.addItem(e),this._getView(e)},NelioContent.views.CalendarDay.prototype.removeItem=function(e){_.contains(this._items,e)&&(this._removeAssociatedView(e),this._items=_.without(this._items,e),this._updateHiddenItemsCount())},NelioContent.views.CalendarDay.prototype.dragItem=function(e){this._items=_.without(this._items,e),delete this._views[this._getViewKey(e)]},NelioContent.views.CalendarDay.prototype._removeAssociatedView=function(e){this._getViewKey(e);var t=this._views[this._getViewKey(e)];t&&(delete this._views[this._getViewKey(e)],this.calendar.stopListening(t),t.close())},NelioContent.views.CalendarDay.prototype.sortItems=function(){this._items=_.sortBy(this._items,function(e){var t;switch(e.get("calendarKind")){case"task":t="a"+e.get("dateDue").format("YYYY-MM-DDTHH:mm")+e.get("task");break;case"post":var i=e.get("date");t="b"+(i=i?i.format("YYYY-MM-DDTHH:mm"):"9999-99-99T99:99")+"a";break;case"social":t="b"+e.get("schedule").format("YYYY-MM-DDTHH:mm")+"b","twitter"===e.get("network")?t+="a":t+="b",t+=e.get("network")+e.get("profileId")+e.get("text");break;default:t="z"}return t})},NelioContent.views.CalendarDay.prototype._updateHiddenItemsCount=function(){var t=0,i=0;_.each(this._items,function(e){this.calendar.collection.applyFilters(e)&&++i>this._minNumOfNonCollapsableItems&&"social"===e.get("calendarKind")&&_.contains(this._collapsableStatuses,e.get("status"))&&++t},this),this._moreSocialView.setCount(t)},(e={object:{},extend:function(e){this.object=_.extend(this.object,e)}}).extend({_$window:void 0,_wp:{$adminbar:void 0,$adminmenuwrap:void 0,$collapseMenu:void 0,$collapseButton:void 0},events:{"change .nc-unscheduled-posts .nc-search input":"_searchUnscheduledPosts","keyup .nc-unscheduled-posts .nc-search input":"_searchUnscheduledPosts","change .nc-post-filter":"_onPostFilterChange","change .nc-social-filter":"_onSocialFilterChange","click .nc-enabled .nc-action.nc-today":"_today","click .nc-enabled .nc-action.nc-month.nc-prev":"_prevMonth","click .nc-enabled .nc-action.nc-month.nc-next":"_nextMonth","click .nc-toggle-publication":"_toggleMessagePublication","click .nc-toggle-unscheduled-posts":"_toggleUnscheduledPostsVisibility","click .nc-export-action:not( .nc-disabled )":"_openExportDialog","click .nc-enabled .nc-action.nc-add-post":"_addPost","click .nc-enabled .nc-action.nc-add-social":"_addSocial","click .nc-enabled .nc-action.nc-add-task":"_addTask"},initialize:function(){if(this._$window=c(window),this._wp.$adminbar=c("#adminbar"),this._wp.$adminmenuwrap=c("#adminmenuwrap"),this._wp.$collapseMenu=c("#collapse-menu"),this._wp.$collapseButton=c("#collapse-button"),this.render=_.bind(this.render,this),this._initUnscheduledPosts(),this._fixShadows=_.debounce(this._fixShadows,150),this._scrollToToday=_.debounce(this._scrollToToday,250),this._maybeHighlightItems=_.debounce(this._maybeHighlightItems,100),this._renderDebounced=_.debounce(this.render,120),this._resizeDebounced=_.bind(_.debounce(this._resize,200),this),this._doSearchUnscheduledPosts=_.bind(_.debounce(this._doSearchUnscheduledPosts,400),this),this.listenTo(this.collection,"add",this._addItem),this.listenTo(this.collection,"remove",this._removeItem),this.listenTo(this.collection,"nc:change:date",this._updateDaysInGrid),this.listenTo(this.collection,"nc:items:loaded",this._onItemsLoaded),this.listenTo(this.collection,"nc:change:isLoading",this._onLoadingItems),this.listenTo(this,"nc:render:debounced",this._renderDebounced),this.listenTo(this,"nc:render:now",this.render),this._resize=_.bind(this._resize,this),this._onCalendarScroll=_.bind(this._onCalendarScroll,this),this._scrollCalendarUp=_.bind(this._scrollCalendarUp,this),this._scrollCalendarDown=_.bind(this._scrollCalendarDown,this),!NelioContent.profiles.isReady()){var e=this;this.listenToOnce(NelioContent.profiles,"nc:ready",function(){e.collection.isLoading()||e.unlock(),e._renderDebounced()}),this.listenToOnce(NelioContent.profiles,"nc:error",function(){NelioContent.helpers.openErrorDialog(NelioContent.i18n.errors.api.unableToRetrieveProfiles)}),this.listenToOnce(NelioContent.profiles,"nc:error",this._renderDebounced)}},close:function(){this.stopListening(),this.unbind(),this._$window.off("resize",this._resize),this._wp.collapseMenu.off("click",this._resizeDebounced),this._wp.collapseButton.off("click",this._resizeDebounced),this._ui.$calendar.off("scroll",this._onCalendarScroll),"object"==typeof this._taskFilterView&&this._taskFilterView.close(),void 0!==this.el&&(this.remove(),this.el=void 0,this.$el=void 0)}}),e.extend({_onItemsLoaded:function(){this.collection.each(function(e){var t=this._findCalendarDay(e.getRelevantDay());void 0!==t&&t.addItem(e)},this),_.each(this._daysInGrid,function(e){e.sortItems()}),this.trigger("nc:render:now"),this.collection.length&&this._fixScroll()},_addItem:function(t){var e=this._findCalendarDay(t.getRelevantDay());void 0!==e&&(_.each(_.without(this._daysInGrid,e),function(e){e.removeItem(t)}),e.addItem(t),e.sortItems(),e.render())},_removeItem:function(t){_.each(this._daysInGrid,function(e){e.removeItem(t)})},createItemView:function(e){if(this._dragging.active&&e.get("id")===this._dragging.view.model.get("id"))return!1;var t=new NelioContent.views.CalendarItem({model:e,$containment:this._ui.$container});switch(t.render(),this.listenTo(t,"nc:drag:start",this._onDragStart),this.listenTo(t,"nc:drag:stop",this._onDragStop),this.listenTo(t,"nc:enter:mouse",this._highlightItems),this.listenTo(t,"nc:leave:mouse",this._homogenizeItems),t.model.get("calendarKind")){case"post":this.listenTo(t,"nc:click",this._editPost);break;case"social":"error"===t.model.get("status")?this.listenTo(t,"nc:click",this._openSocialErrorDialog):t.model.get("isFreePreview")?this.listenTo(t,"nc:click",function(){c(NelioContent.i18n.dialogs.subscribeForAutomations).dialog({title:NelioContent.i18n.titles.suggestSubscription,modal:!0,width:Math.min(500,c(window).width()-20),dialogClass:"nc-dialog"})}):this.listenTo(t,"nc:click",this._editSocial);break;case"task":this.listenTo(t,"nc:click",this._toggleTaskCompletion)}return t}}),e.extend({_addPost:function(e){var t=e.target||e.srcElement,i=c(t).closest(".nc-add-post"),n=new NelioContent.views.PostEditor({model:new NelioContent.models.Post,date:i.data("date")}),s=this;this.listenTo(n,"nc:save:post",function(e){e.get("date")?s.collection.add(e):s._unscheduledPosts.add(e)}),this.listenTo(n,"nc:close:dialog",function(e){s.stopListening(n)}),n.render()},_addSocial:function(e){if(NelioContent.helpers.isSubscribed())if(0!==NelioContent.profiles.length){var t=e.target||e.srcElement,i=c(t).closest(".nc-add-social"),n=new NelioContent.models.SocialMessage;n.set("profileId",NelioContent.profiles.at(0).get("id"));var s=ncNewLocalMoment(i.data("date")),o=ncNewLocalMoment();s.format("YYYYMMDD")===o.format("YYYYMMDD")?(n.set("dateType","predefined-offset"),n.set("dateValue","0"),n.set("timeType","predefined-offset"),n.set("timeValue","0")):(n.set("dateType","exact"),n.set("dateValue",i.data("date")),n.set("timeType","time-interval"),n.set("timeValue","morning"));var l=new NelioContent.views.SocialMessageEditor({model:n}),a=this;this.listenTo(l,"nc:add:messages",function(e){for(var t=0;t<e.length;++t)e[t].calendarKind="social";a.collection.add(e)}),this.listenTo(l,"nc:close:dialog",function(e){a.stopListening(l)}),l.render()}else this._openNoProfilesDialog();else e.preventDefault()},_addTask:function(e){if(NelioContent.helpers.isSubscribed()){var t=e.target||e.srcElement,i=c(t).closest(".nc-add-task"),n=new NelioContent.views.TaskDialog({model:new NelioContent.models.EditorialTask,date:i.data("date")}),s=this;this.listenTo(n,"nc:save:task",function(e){e.calendarKind="task",s.collection.add(e)}),this.listenTo(n,"nc:close:dialog",function(e){s.stopListening(n)}),n.render()}else e.preventDefault()},_openNoProfilesDialog:function(){var e=c("<div></div>").html(document.getElementById("_nc-no-profile-available").innerHTML);e.dialog({title:NelioContent.i18n.titles.addSocialProfiles,modal:!0,width:450,dialogClass:"nc-dialog",open:function(){e.find("a").blur()},buttons:[{text:NelioContent.i18n.actions.addSocialProfile,class:"button button-primary",click:function(){document.location.href=NelioContent.pages.settings}}]})},_toggleMessagePublication:function(){if(this.collection.isMessagePublicationPaused())this._doToggleMessagePublication();else var e=this,t=NelioContent.helpers.openConfirmationDialog(NelioContent.i18n.titles.pausePublication,NelioContent.i18n.dialogs.pausePublication,NelioContent.i18n.actions.pause,function(){t.dialog("close"),e._doToggleMessagePublication()})},_doToggleMessagePublication:function(){var t=this;t.lock(),c.ajax({url:ajaxurl,data:{action:"nelio_content_pause_message_publication",pause:t.collection.isMessagePublicationPaused()?0:1},success:function(e){t.collection._isMessagePublicationPaused=e,t.unlock(),t._fixMessagePublicationIcon()},error:function(e){NelioContent.helpers.openErrorDialog(e.responseJSON),t.unlock()}})},_openExportDialog:function(){var e=NelioContent.helpers.getTemplate("_nc-export-dialog"),t=NelioContent.i18n.titles.exportCalendar;NelioContent.helpers.openDialog(t,e()).find(".nc-download-csv").click(_.bind(function(){this._downloadCSV()},this))},_downloadCSV:function(){if(NelioContent.helpers.isSubscribed()){var s=this;this.lock(),this.listenToOnce(this.collection,"nc:download:csv",function(e){var t=window.URL||window.webkitURL,i=new Blob([e],{type:"text/csv;charset=UTF-8",encoding:"UTF-8"}),n=document.createElement("a");n.setAttribute("href",t.createObjectURL(i)),n.setAttribute("download",s.collection.getFirstDayOfMonth().locale("en").format("YYYY-MM")+".csv"),document.body.appendChild(n),n.click(),document.body.removeChild(n),s.unlock()}),this.collection.toCSV()}}}),e.extend({_autoscrollInterval:0,_dragging:{active:!1,detached:!1,dropArea:"none",originalDate:"",view:void 0},_detachDraggingObject:function(){this._dragging.detached=!0,this._dragging.view.$el.detach(),this.stopListening(this.collection,"nc:change:date",this._detachDraggingObject)},_onDragStart:function(e,t){this.$(".nc-context-actions").addClass("nc-dragging"),"post"===e.get("calendarKind")&&this.$(".nc-unscheduled-posts").addClass("nc-dragging"),this.listenTo(this.collection,"nc:change:date",this._detachDraggingObject),this._dragging.active=!0,this._dragging.view=t,this._dragging.detached=!1,this._dragging.originalDate=e.getRelevantDay();var i=e.getRelevantDay();_.each(this._daysInGrid,function(e){e.getDate()===i&&e.dragItem(t.model),_.each(e.getViews(),function(e){e.blur()})})},_onDragStop:function(e,t){if(this.$(".nc-context-actions").removeClass("nc-dragging"),this.$(".nc-unscheduled-posts").removeClass("nc-dragging"),this.stopListening(this.collection,"nc:change:date",this._detachDraggingObject),"none"!==this._dragging.dropArea)if("trash"!==this._dragging.dropArea)if("unschedule"!==this._dragging.dropArea){var i=this._dragging.dropArea;NelioContent.helpers.isDate(i)&&i!==this._dragging.originalDate?this._rescheduleItem(e,t):this._abortDraggingObjectChanges(e,t)}else e.get("date")?this._unschedulePost(e,t):(this._abortDraggingObjectChanges(e,t),this._unscheduledPosts.add(e),this._renderUnscheduledPosts());else this._deleteDraggingObject(e,t);else this._abortDraggingObjectChanges(e,t)},_cleanDraggingObject:function(){var e=this,t=e._dragging.view,i=e._dragging.dropArea;function n(){e._dragging.view===t&&(e._dragging.view=void 0,e._dragging.active=!1,e._dragging.dropArea="none"),"trash"===i&&e.collection.remove(t.model.get("id")),e._fixControls(),t.close()}e.collection.isLoading()?e.listenToOnce(e.collection,"nc:change:isLoading",n):n()},_abortDraggingObjectChanges:function(e,t){this.collection.remove(e),this._cleanDraggingObject(),this.collection.add(e)},_rescheduleItem:function(n,s){var t=this,o=this._dragging.dropArea;_.each(this._daysInGrid,function(e){if(e.getDate()===o){var t=this._dragging.view,i=this._dragging.active;this._dragging.view=!1,this._dragging.active=!1,e.addItemAndGenerateView(n),this._dragging.view=t,this._dragging.active=i,e.sortItems(),e.render(),s.close()}},this),"post"===n.get("calendarKind")?this.listenToOnce(n,"nc:reschedule",function(){t._unscheduledPosts.remove(n),t._cleanDraggingObject(),t.collection.refreshPost(n.get("id")),t.stopListening(n,"nc:abort:reschedule"),t.stopListening(n,"nc:error")}):"social"===n.get("calendarKind")?this.listenToOnce(n,"nc:reschedule",function(e){_.each(e,function(e){"muted"===e.status?t.collection.remove(e.id):t.collection.add(new NelioContent.models.SocialMessage(e))}),t.stopListening(n,"nc:abort:reschedule"),t.stopListening(n,"nc:error"),t.unlock(),t._cleanDraggingObject()}):this.listenToOnce(n,"nc:reschedule",function(){t.stopListening(n,"nc:abort:reschedule"),t.stopListening(n,"nc:error"),t.unlock(),t._cleanDraggingObject()}),this.listenToOnce(n,"nc:abort:reschedule",function(e){"object"==typeof e&&NelioContent.helpers.openWarningDialog(e.title,e.content),t.stopListening(n,"nc:reschedule"),t.stopListening(n,"nc:error"),t.unlock(),t._cleanDraggingObject()}),this.listenToOnce(n,"nc:error",function(){var e=NelioContent.i18n.errors.generic.unableToRescheduleItem;NelioContent.helpers.openErrorDialog(e),t._cleanDraggingObject(),t.collection.refresh(),t.stopListening(n,"nc:reschedule"),t.stopListening(n,"nc:abort:reschedule")}),this.lock(),this._dragging.view.lock(),n.reschedule(t._dragging.dropArea)},_deleteDraggingObject:function(i,e){this.lock();var n=this;e.$el.detach(),"post"===i.get("calendarKind")?(this.listenToOnce(i,"nc:trash",function(){n.stopListening(n._dragging.view),n._cleanDraggingObject(),n._homogenizeItems(),n.collection.refreshPost(i.get("id"))}),this.listenToOnce(i,"nc:error",function(e){var t=NelioContent.i18n.errors.post.unableToTrash;t=t.replace("{error}",e.replace(/\.$/,"")),NelioContent.helpers.openErrorDialog(t),n.stopListening(n._dragging.view),n._cleanDraggingObject(),n._homogenizeItems(),n.collection.refreshPost(i.get("id"))}),i.trash()):i.destroy({success:function(e,t){n.stopListening(n._dragging.view),n._cleanDraggingObject(),_.each(t,function(e){"muted"===e.status?n.collection.remove(e.id):n.collection.add(new NelioContent.models.SocialMessage(e))}),n._homogenizeItems(),n.unlock()},error:function(){var e=NelioContent.i18n.errors.generic.unableToDeleteItem;NelioContent.helpers.openErrorDialog(e),n.stopListening(n._dragging.view),n._cleanDraggingObject(),n._homogenizeItems(),n.collection.refresh()}})},_buildDroppableAreas:function(){var e=this,i=this.collection;this._ui.$scrollUpArea.droppable({accept:".nc-draggable-calendar-item",hoverClass:"hovering",tolerance:"touch",over:function(){clearInterval(e._autoscrollInterval),e._autoscrollInterval=setInterval(e._scrollCalendarUp,50)},out:function(){clearInterval(e._autoscrollInterval)},drop:function(){clearInterval(e._autoscrollInterval)}}),this._ui.$scrollDownArea.droppable({accept:".nc-draggable-calendar-item",hoverClass:"hovering",tolerance:"touch",over:function(){clearInterval(e._autoscrollInterval),e._autoscrollInterval=setInterval(e._scrollCalendarDown,50)},out:function(){clearInterval(e._autoscrollInterval)},drop:function(){clearInterval(e._autoscrollInterval)}}),this.$(".nc-day").droppable({accept:".nc-draggable-calendar-item",hoverClass:"nc-highlight",tolerance:"pointer",drop:function(){e._dragging.dropArea=c(this).data("date")}}),this.$(".nc-unscheduled-posts .nc-list").droppable({accept:".nc-draggable-calendar-item",hoverClass:"nc-highlight",tolerance:"pointer",drop:function(){e._dragging.dropArea="unschedule"}}),this.$(".nc-action.nc-trash").droppable({drop:function(){e._dragging.dropArea="trash"},tolerance:"pointer",hoverClass:"nc-hover"});var t={drop:function(e,t){clearInterval(this.__interval),this.__interval=void 0},out:function(e,t){clearInterval(this.__interval),this.__interval=void 0},tolerance:"pointer",hoverClass:"nc-hover",over:function(e,t){void 0===this.__interval&&(this.__interval=setInterval(function(){i.prevMonth()},1e3))}};this.$(".nc-area.nc-month.nc-prev").droppable(t),t.over=function(e,t){void 0===this.__interval&&(this.__interval=setInterval(function(){i.nextMonth()},1e3))},this.$(".nc-area.nc-month.nc-next").droppable(t)},_scrollCalendarUp:function(){this._ui.$calendar[0].scrollTop-=20},_scrollCalendarDown:function(){this._ui.$calendar[0].scrollTop+=20}}),e.extend({_editPost:function(t){var e="";t.get("date")&&(e=t.get("date").format("YYYY-MM-DD"));var i=new NelioContent.views.PostEditor({model:new NelioContent.models.Post(t.toJSON()),date:e}),n=this;this.listenTo(i,"nc:save:post",function(e){n.lock(),n._unscheduledPosts.remove(e.get("id")),e.get("date")?(n.collection.remove(e.get("id")),n.collection.add(e)):(n.collection.remove(e.get("id")),n._unscheduledPosts.add(e)),n.collection.refreshPost(t.get("id"))}),this.listenTo(i,"nc:trash:post",function(){n.collection.remove(t),n._unscheduledPosts.remove(t),n.lock(),n.collection.refreshPost(t.get("id"))}),this.listenTo(i,"nc:close:dialog",function(){n.stopListening(i)}),this._fixControls(),i.render()},_editSocial:function(t){var e=new NelioContent.models.SocialMessage(t.toJSON()),i=new NelioContent.views.SocialMessageEditor({model:e}),n=this;this.listenTo(i,"nc:update:message",function(e){e.calendarKind="social",n.collection.remove(t),n.collection.add(e)}),this.listenTo(i,"nc:delete:message",function(e){n.collection.remove(e)}),this.listenTo(i,"nc:close:dialog",function(){n.stopListening(i)}),this._fixControls(),i.render()},_openSocialErrorDialog:function(e){var t,i=this,n=e.get("failureDescription");t=0===NelioContent.helpers.trim(n)?NelioContent.i18n.dialogs.socialNotSentUnknown:NelioContent.i18n.dialogs.socialNotSent.replace("{error}",_.escape(e.get("failureDescription")));var s=c('<div class="nc-error-dialog">'+t+"</div>");s.dialog({title:NelioContent.i18n.titles.socialNotSent,modal:!0,width:Math.min(500,c(window).width()-20),dialogClass:"nc-dialog",buttons:[{class:"button",text:NelioContent.i18n.actions.editSocial,click:function(){i._editSocial(e),s.dialog("close"),s.dialog("destroy")}},{class:"button button-primary",text:NelioContent.i18n.actions.sendSocialNow,click:function(){e.shareNow(),s.dialog("close"),s.dialog("destroy")}}]})},_toggleTaskCompletion:function(e){this.lock(),e.toggleCompletionInAws(_.bind(function(){this.unlock()},this))}}),e.extend({_socialFilterTemplates:{profile:NelioContent.helpers.getTemplate("_nc-single-profile-selector-profile"),network:NelioContent.helpers.getTemplate("_nc-network-option"),selectedProfile:NelioContent.helpers.getTemplate("_nc-single-profile-selector-selected-profile"),selectedNetwork:NelioContent.helpers.getTemplate("_nc-network-option"),userOption:NelioContent.helpers.getTemplate("_nc-user-selector-option")},_taskFilterView:!1,_buildFilters:function(){NelioContent.helpers.buildPostFilter(this.$(".nc-post-filter")),"all"!==this.collection.getFilter("post")&&(this.$(".nc-post-filter").val(this.collection.getFilter("post")),this.$(".nc-post-filter").trigger("change")),this._buildSocialFilter(),this._buildTaskFilter()},_buildSocialFilter:function(){var e=[{id:"all",text:NelioContent.i18n.filters.actions.showSocialMessages},{id:"none",text:NelioContent.i18n.filters.actions.hideSocialMessages}];if(!NelioContent.profiles.isReady())return this.$(".nc-social-filter").css("width","15em"),void this.listenToOnce(NelioContent.profiles,"nc:ready",this._buildSocialFilter);if(0<NelioContent.profiles.length){var t=NelioContent.profiles.toJSON();_.each(t,function(e){e.text=e.displayName,e.ncselect2Type="profile"});var i=_.uniq(_.pluck(t,"network")).sort(),n=[];_.each(i,function(e){var t=_.findWhere(NelioContent.networkMetas,{id:e});void 0!==t&&n.push({id:"nc:network:"+t.id,displayName:t.name,network:t.id,ncselect2Type:"network",text:t.name})}),e.push({text:NelioContent.i18n.filters.groups.network,children:n}),e.push({text:NelioContent.i18n.filters.groups.profile,children:t})}var s=this._socialFilterTemplates.profile,o=this._socialFilterTemplates.network,l=this._socialFilterTemplates.selectedProfile,a=this._socialFilterTemplates.selectedNetwork;this.$(".nc-social-filter").ncselect2({data:e,dropdownCssClass:"nc-social-filter",width:"15em",templateResult:function(e){switch(e.ncselect2Type){case"profile":return c(s(e));case"network":return c(o(e));default:return e.text}},templateSelection:function(e){switch(e.id){case"all":return NelioContent.i18n.filters.selection.allSocialMessages;case"none":var t=NelioContent.i18n.filters.selection.noSocialMessages;return c('<span><span class="nc-dashicons nc-dashicons-hidden"></span> '+t+"</span>");default:return"profile"===e.ncselect2Type?c(l(e)):c(a(e))}}}),this.$(".nc-social-filter").val(this.collection.getFilter("social")).trigger("change")},_buildTaskFilter:function(){var e=this.$(".nc-task-filter");0!==e.length&&(this._taskFilterView=new NelioContent.views.UserFilter({el:e,dropdownCssClass:"nc-task-filter",width:"15em",defaultValue:this.collection.getFilter("task"),actions:{all:NelioContent.i18n.filters.actions.showTasks,none:NelioContent.i18n.filters.actions.hideTasks},labels:{group:NelioContent.i18n.filters.groups.assignee,all:NelioContent.i18n.filters.selection.allTasks,none:NelioContent.i18n.filters.selection.noTasks,single:NelioContent.i18n.filters.selection.tasksOf}}),this.listenTo(this._taskFilterView,"nc:change",this._onTaskFilterChange),this._taskFilterView.render())},_onPostFilterChange:function(){this.lock();var e=this.$(".nc-post-filter").val();isNaN(parseInt(e))?this.collection.setFilter("post",e):this.collection.setFilter("post",parseInt(e))},_onSocialFilterChange:function(){this.lock(),this.collection.setFilter("social",this.$(".nc-social-filter").val())},_onTaskFilterChange:function(e){this.lock(),isNaN(parseInt(e))?this.collection.setFilter("task",e):this.collection.setFilter("task",parseInt(e))}}),e.extend({_resize:function(){var e=NelioContent.helpers.getScrollbarWidth(),t=this._getAvailableHeight(),i=this._ui.$helperDivForCalendarWidth.width();this._areUnscheduledPostsVisible?(this._ui.$toggleUnscheduledPosts.removeClass("nc-dashicons-portfolio"),this._ui.$toggleUnscheduledPosts.addClass("nc-dashicons-calendar-alt"),this._ui.$toggleUnscheduledPosts.attr("title",NelioContent.i18n.actions.hideUnscheduledPosts),this._ui.$unscheduledPosts.addClass("nc-visible"),this._ui.$container.css("width",i),i-=210):(this._ui.$toggleUnscheduledPosts.removeClass("nc-dashicons-calendar-alt"),this._ui.$toggleUnscheduledPosts.addClass("nc-dashicons-portfolio"),this._ui.$toggleUnscheduledPosts.attr("title",NelioContent.i18n.actions.showUnscheduledPosts),this._ui.$unscheduledPosts.removeClass("nc-visible"),this._ui.$container.css("width",i)),this._fixMessagePublicationIcon(),this._ui.$container.height(t),this._ui.$header.width(i),t-=this._ui.$header.height(),this._ui.$unscheduledPosts.css("top",this._ui.$header.height()-this._ui.$weekDays.height()),this._ui.$unscheduledPosts.css("height",t+this._ui.$weekDays.height()),this._ui.$calendarHolder.width(i),this._ui.$calendarHolder.height(t),this._ui.$actions.height(t),this._ui.$calendar.css("height",t);var n=this._ui.$container[0].getBoundingClientRect(),s=this._ui.$monthActionAreas[0].getBoundingClientRect(),o=Math.floor(n.bottom-s.top-10),l=Math.max(Math.floor(o-Math.floor(t/2)-20),0);this._ui.$monthActionAreas.css("padding-top",l),this._ui.$monthActionAreas.height(o-l);var a=i-2*this._ui.$actions.width();this._ui.$scrollUpArea.width(a),this._ui.$scrollDownArea.width(a);var c=Math.ceil(t/6);c<130&&this.$(".nc-day").css("min-height",c),"ltr"===this._ui.textDirection?(this._ui.$calendar.css("padding-left",this._ui.$actions.width()+e),this._ui.$calendar.css("padding-right",this._ui.$actions.width())):(this._ui.$calendar.css("padding-left",this._ui.$actions.width()),this._ui.$calendar.css("padding-right",this._ui.$actions.width()+e)),this._ui.$calendar.css("margin-left",-e),this._ui.$calendar.width(i-2*this._ui.$actions.width()+e),this._ui.$container.removeClass("nc-small"),this._ui.$container.removeClass("nc-smallest"),i<900?this._ui.$container.addClass("nc-smallest"):i<1250&&this._ui.$container.addClass("nc-small"),this._fixShadows()},_fixMessagePublicationIcon:function(){this.collection.isMessagePublicationPaused()?(this._ui.$togglePublication.removeClass("nc-dashicons-controls-pause"),this._ui.$togglePublication.addClass("nc-dashicons-controls-play"),this._ui.$togglePublication.attr("title",NelioContent.i18n.actions.resumePublication)):(this._ui.$togglePublication.removeClass("nc-dashicons-controls-play"),this._ui.$togglePublication.addClass("nc-dashicons-controls-pause"),this._ui.$togglePublication.attr("title",NelioContent.i18n.actions.pausePublication))},_onCalendarScroll:function(){this._fixShadows(),this._isLocked||(this._scroll.position=this._ui.$calendar.scrollTop())},_resetScroll:function(){this._scroll.seekToday=!0,this._scroll.position=0,this._ui.$calendar.scrollTop(this._scroll.position)},_fixScroll:function(){this._scroll.seekToday?this._scrollToToday():this._ui.$calendar.scrollTop(this._scroll.position)},_scrollToToday:function(){this._scroll.seekToday=!1;var e=this.$(".nc-day.nc-today");if(0!==e.length){var t=e[0].getBoundingClientRect(),i=this._ui.$header[0].getBoundingClientRect();if(i.bottom+100!==t.top){var n=t.top-i.bottom-100;this._scroll.position=this._ui.$calendar.scrollTop()+n,this._ui.$calendar.animate({scrollTop:this._scroll.position},500)}}},_fixShadows:function(){this._ui.$calendar[0].scrollTop<=0?this._ui.$calendarHolder.removeClass("nc-top-shadow"):this._ui.$calendarHolder.addClass("nc-top-shadow"),this._isScrollAtTheBottom()?this._ui.$calendarHolder.removeClass("nc-bottom-shadow"):this._ui.$calendarHolder.addClass("nc-bottom-shadow"),0!==this._ui.$calendar.scrollLeft()&&this._ui.$calendar.scrollLeft(0)},_isScrollAtTheBottom:function(){return this._ui.$calendar[0].scrollHeight-this._ui.$calendar.scrollTop()<=this._ui.$calendar.outerHeight()},_getAvailableHeight:function(){return window.innerHeight-this._wp.$adminbar.height()-100}}),e.extend({_daysInGrid:[],_updateDaysInGrid:function(){var t=this,i=this.collection.getFirstDay(),n=this.collection.getToday(),s=i.clone().add(14,"d");_.each(t._daysInGrid,function(e){e.$el.data("date",i.format("YYYY-MM-DD")),e.$el.attr("class","nc-day "+t._getDayClasses(i,s,n)),e.$el.find(".nc-action").data("date",i.format("YYYY-MM-DD")),e.$el.find(".nc-day-number").text(i.format("DD")),e.setDate(i.format("YYYY-MM-DD")),i.add(1,"d")})},_findCalendarDay:function(e){for(var t=0;t<this._daysInGrid.length;++t)if(this._daysInGrid[t].getDate()===e)return this._daysInGrid[t]}}),e.extend({_today:function(){return this._resetScroll(),this.collection.gotoDate(ncNewLocalMoment()),!1},_prevMonth:function(){return this._resetScroll(),this.collection.prevMonth(),!1},_nextMonth:function(){return this._resetScroll(),this.collection.nextMonth(),!1}}),e.extend({_rendering:!1,_rendered:!1,_isLocked:!1,_isSynching:!1,_highlightedPostId:0,_scroll:{position:0,seekToday:!0},_ui:{textDirection:"ltr",$actions:void 0,$calendar:void 0,$calendarHolder:void 0,$container:void 0,$unscheduledPosts:void 0,$downloadCSV:void 0,$grid:void 0,$header:void 0,$helperDivForCalendarWidth:void 0,$monthActionAreas:void 0,$scrollDownArea:void 0,$scrollUpArea:void 0,$toggleUnscheduledPosts:void 0,$togglePublication:void 0,$quickActions:void 0,$weekDays:void 0},template:NelioContent.helpers.getTemplate("_nc-calendar"),_dayTemplate:NelioContent.helpers.getTemplate("_nc-day"),render:function(){if(this._rendering)return this;this._rendering=!0;var e=this.collection.getToday(),t=this.collection.getFirstDayOfMonth(),i=e;this.collection.isTodayVisible()||(i=ncNewLocalMoment(t.format("YYYY-MM-")+"01 12:00")),this._rendered||(this.collection.isLoading()&&(this._isSynching=!0,this._isLocked=!0),this.el.innerHTML=this.template({newItemDate:i.format("YYYY-MM-DD")}),this._ui.$actions=this.$(".nc-context-actions"),this._ui.$monthActionAreas=this.$(".nc-permanent-actions .nc-area.nc-month"),this._ui.$calendar=this.$(".nc-calendar"),this._ui.$calendarHolder=this.$(".nc-calendar-holder"),this._ui.$container=this.$(".nc-calendar-page-container"),this._ui.$unscheduledPosts=this.$(".nc-unscheduled-posts"),this._ui.$unscheduledPostSearch=this.$(".nc-unscheduled-posts .nc-search"),this._ui.$downloadCSV=this.$(".nc-export-action"),this._ui.$grid=this.$(".nc-grid"),this._ui.$header=this.$(".nc-calendar-header"),this._ui.$helperDivForCalendarWidth=this.$(".nc-helper-div"),this._ui.$scrollDownArea=this.$(".nc-scroll-down-area"),this._ui.$scrollUpArea=this.$(".nc-scroll-up-area"),this._ui.$toggleUnscheduledPosts=this.$(".nc-toggle-unscheduled-posts"),this._ui.$togglePublication=this.$(".nc-toggle-publication"),this._ui.$quickActions=this.$(".nc-quick-actions"),this._ui.$weekDays=this.$(".nc-days-of-week"),this._ui.textDirection=window.getComputedStyle(this._ui.$calendar[0],null).getPropertyValue("direction"),this._buildFilters(),this._$window.on("resize",this._resizeDebounced),this._wp.$collapseMenu.on("click",this._resizeDebounced),this._wp.$collapseButton.on("click",this._resizeDebounced),this._ui.$calendar.on("scroll",this._onCalendarScroll),this._renderHeader(),this._renderGrid(),this._buildDroppableAreas()),this._updateDaysInGrid();var n=NelioContent.helpers.capitalizeFirstLetter(t.format("MMMM"));return this.$(".nc-current-month .nc-month").text(n),this.$(".nc-current-month .nc-year").text(t.year()),this.el.className="nc-"+t.locale("en").format("MMMM").toLowerCase(),this.$(".nc-day").droppable("disable"),this.$(".nc-day.nc-today, .nc-day.nc-future").droppable("enable"),_.each(this._daysInGrid,function(e){e.render()}),this._homogenizeItems(),this._fixControls(),this._resize(),this._rendered=!0,this._rendering=!1,this},_fixControls:function(){_.each(this._daysInGrid,function(e){this._isLocked?e.getMoreSocialView().lock():e.getMoreSocialView().unlock(),_.each(e.getViews(),function(e){this._isLocked?e.lock():e.unlock(),this._dragging.active?e.blur():e.homogenize()},this)},this),_.each(this._unscheduledPostViews,_.bind(function(e){this._isLocked?e.lock():e.unlock()},this)),this._isSynching||this._isLocked?(this.$(".nc-cal-sync").addClass("is-active"),this._ui.$quickActions.hide()):(this.$(".nc-cal-sync").removeClass("is-active"),this._ui.$quickActions.show()),this._isLocked?(this.$(".button").prop("disabled",!0),this.$(".nc-day .nc-actions").removeClass("nc-enabled"),this.$(".nc-regular-actions").removeClass("nc-enabled"),this.$(".nc-context-actions").removeClass("nc-enabled"),this.$(".nc-calendar-actions").removeClass("nc-enabled"),this.$(".nc-post-filter").prop("disabled",!0),this.$(".nc-social-filter").prop("disabled",!0),this.$(".nc-unscheduled-posts .nc-search input").prop("disabled",!0),"object"==typeof this._taskFilterView&&this._taskFilterView.lock()):(this.$(".button").prop("disabled",!1),this.$(".nc-day .nc-actions").addClass("nc-enabled"),this.$(".nc-regular-actions").addClass("nc-enabled"),this.$(".nc-context-actions").addClass("nc-enabled"),this.$(".nc-calendar-actions").addClass("nc-enabled"),this.$(".nc-post-filter").prop("disabled",!1),this.$(".nc-social-filter").prop("disabled",!1),this.$(".nc-unscheduled-posts .nc-search input").prop("disabled",!1),"object"==typeof this._taskFilterView&&this._taskFilterView.unlock(),this.$(".button.nc-action.nc-today").prop("disabled",this.collection.isTodayVisible()))},lock:function(){this._isSynching=!0,this._isLocked=!0,this._fixControls()},unlock:function(){this._isSynching=!NelioContent.profiles.isReady(),this._isLocked=!NelioContent.profiles.isReady(),this._fixControls()},showLoader:function(){this._isLocked||(this._isSynching=!0,this._fixControls())},hideLoader:function(){this._isSynching=!1,this._fixControls()},_onLoadingItems:function(e){e?this.showLoader():this.unlock()},_renderHeader:function(){var e=this.collection.getFirstDay(),t=this._ui.$weekDays[0],i="";e=this.collection.getFirstDay();for(var n=0;n<7;++n)i+="<span>"+e.format("ddd")+"</span>",e.add(1,"d");e.add(-7,"d"),t.innerHTML=i},_renderGrid:function(){for(var e=this.collection.getFirstDay(),t=(this.collection.getToday(),this),i=this.$(".nc-grid")[0],n="",s=0;s<6;++s)for(var o=0;o<7;++o)n+=this._dayTemplate(),e.add(1,"d");i.innerHTML=n;var l=this;this.$(".nc-day").each(function(){t._daysInGrid.push(new NelioContent.views.CalendarDay(l,c(this)))})},_getDayClasses:function(e,t,i){var n="";return(e.year()<t.year()||e.month()<t.month())&&(n="nc-other-month "),(e.year()>t.year()||e.month()>t.month())&&(n="nc-other-month "),e.year()<i.year()?n+="nc-past":e.year()>i.year()?n+="nc-future":e.dayOfYear()<i.dayOfYear()?n+="nc-past":e.dayOfYear()>i.dayOfYear()?n+="nc-future":n+="nc-today",n},_highlightItems:function(e,t){this._maybeHighlightItems("enter",e,t)},_homogenizeItems:function(){this._maybeHighlightItems("leave")},_maybeHighlightItems:function(t,i,n){this._dragging.active||(this._highlightedPostId=n,_.each(this._daysInGrid,function(e){_.each(e.getViews(),function(e){switch(e.model.get("calendarKind")){case"post":"leave"===t?e.homogenize():0<n&&e.model.get("id")===n?e.highlight():e.blur();break;default:"leave"===t?e.homogenize():0<n&&e.model.get("postId")===n?e.highlight():e.model.get("id")===i?e.highlight():e.blur()}})}))},_updateListOfAnimatedViews:function(){var t=0;_.each(this._daysInGrid,function(e){7<++t||_.each(e.getViews(),function(e){e._calendarItem.className.indexOf("nc-animated-cal-item")<0&&(e._calendarItem.className+=" nc-animated-cal-item")})})}}),e.extend({_areUnscheduledPostsVisible:ncstore.get("nc-calendar-are-unscheduled-visible["+NelioContent.wpBlogId+"]",!0),_unscheduledSearch:{page:1,hasMorePosts:!1,request:!1,term:void 0},_unscheduledPostViews:[],_unscheduledPosts:new(Backbone.Collection.extend({model:NelioContent.models.Post,comparator:function(e){return-e.get("id")}})),_toggleUnscheduledPostsVisibility:function(){this._areUnscheduledPostsVisible=!this._areUnscheduledPostsVisible,ncstore.set("nc-calendar-are-unscheduled-visible["+NelioContent.wpBlogId+"]",this._areUnscheduledPostsVisible),this._resize()},_initUnscheduledPosts:function(){this.listenTo(this._unscheduledPosts,"add",this._renderUnscheduledPosts),this.listenTo(this._unscheduledPosts,"remove",this._renderUnscheduledPosts),this.listenTo(this._unscheduledPosts,"reset",this._renderUnscheduledPosts),this._doSearchUnscheduledPosts()},_renderUnscheduledPosts:function(){var t=this.$(".nc-unscheduled-posts .nc-list");if(t.empty(),_.each(this._unscheduledPostViews,function(e){e.close()}),this._unscheduledPostViews=[],this._unscheduledPosts.each(_.bind(function(e){var t=new NelioContent.views.CalendarItem({model:e,$containment:this._ui.$container});this.listenTo(t,"nc:drag:start",this._onDragStart),this.listenTo(t,"nc:drag:stop",this._onDragStop),this.listenTo(t,"nc:click",this._editPost),this._unscheduledPostViews.push(t)},this)),_.each(this._unscheduledPostViews,_.bind(function(e){this._dragging.view&&this._dragging.view.model===e.model||(this._isLocked?e.lock():e.unlock(),t.append(e.render().el))},this)),this._unscheduledSearch.request||this._unscheduledPostViews.length||(this._unscheduledSearch.term?t.html('<div class="nc-empty">'+NelioContent.i18n.feedback.noUnscheduledPostsFound+"</div>"):t.html('<div class="nc-empty">'+NelioContent.i18n.feedback.noUnscheduledPosts+"</div>")),!this._unscheduledSearch.request&&this._unscheduledSearch.hasMorePosts){var e=c('<p style="text-align:center;"><a href="#">'+NelioContent.i18n.actions.loadMoreUnscheduled+"</a></p>");t.append(e),e.on("click",_.bind(function(){return e.hasClass("button-disabled")||(this._loadUnscheduledPostsAndUpdateView(),e.addClass("button-disabled")),!1},this))}},_unschedulePost:function(t,e){this._cleanDraggingObject(),this.collection.remove(t);var i=t.toJSON();i.date=!1,this._unscheduledPosts.add(i),this.lock(),c.ajax({url:ajaxurl,data:{action:"nelio_content_unschedule_post",post:t.get("id")},success:_.bind(function(e){this.collection.refreshPost(t.get("id"))},this),error:_.bind(function(e){this._unscheduledPosts.remove(t),this.collection.add(t)},this)})},_searchUnscheduledPosts:_.debounce(function(e){var t=e.target||e.srcElement,i=c(t).val();this._doSearchUnscheduledPosts(i)},100),_doSearchUnscheduledPosts:function(e){if("string"!=typeof e&&(e=""),e!==this._unscheduledSearch.term)this._unscheduledSearch.request&&this._unscheduledSearch.request.abort(),this._unscheduledSearch.term=e,this._unscheduledSearch.page=1,this._unscheduledSearch.hasMorePosts=!1,this._unscheduledPosts.reset(),this._loadUnscheduledPostsAndUpdateView();else try{this._ui.$unscheduledPostSearch.removeClass("nc-searching")}catch(e){}},_loadUnscheduledPostsAndUpdateView:function(){try{this._ui.$unscheduledPostSearch.addClass("nc-searching")}catch(e){}this._unscheduledSearch.request=c.ajax({url:ajaxurl,data:{action:"nelio_content_get_posts",term:this._unscheduledSearch.term,page:this._unscheduledSearch.page,status:"nc_unscheduled"},success:_.bind(function(e){this._unscheduledPosts.add(e.items),this._unscheduledSearch.hasMorePosts=e.more,e.more&&this._unscheduledSearch.page++},this),complete:_.bind(function(){try{this._ui.$unscheduledPostSearch.removeClass("nc-searching")}catch(e){}this._unscheduledSearch.request=!1,this._renderUnscheduledPosts()},this)}),this._renderUnscheduledPosts()}}),NelioContent.views.Calendar=Backbone.View.extend(e.object),(i=location.search.match(/\bdate=([12][01][0-9][0-9]-[01][0-9](-[0123][0-9])?)$/))&&i.length<2&&(i=location.search.match(/\bdate=([12][01][0-9][0-9]-[01][0-9](-[0123][0-9])?)&/)),t=0<(n=i&&2<=i.length?i[1]:"").length?new NelioContent.collections.MonthlyCalendarItems(null,{date:n}):new NelioContent.collections.MonthlyCalendarItems,new NelioContent.views.Calendar({el:c("#nelio-content-calendar"),collection:t}).render()}(jQuery);